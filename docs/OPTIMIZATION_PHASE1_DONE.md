# ‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ - –§–∞–∑–∞ 1 (–í—ã–ø–æ–ª–Ω–µ–Ω–æ)

**–î–∞—Ç–∞**: 8 —è–Ω–≤–∞—Ä—è 2026  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

---

## üéØ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ N+1 –ø—Ä–æ–±–ª–µ–º–∞ –≤ `findByIdWithDetails`

**–§–∞–π–ª**: `server/repositories/estimatesRepository.js`

**–ë—ã–ª–æ**:
- 1 –∑–∞–ø—Ä–æ—Å –¥–ª—è —Å–º–µ—Ç—ã
- 1 –∑–∞–ø—Ä–æ—Å –¥–ª—è —Å–ø–∏—Å–∫–∞ –ø–æ–∑–∏—Ü–∏–π
- **N –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤** (–ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ –∫–∞–∂–¥—É—é –ø–æ–∑–∏—Ü–∏—é)
- –ò—Ç–æ–≥–æ: **N+2 –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î**

**–°—Ç–∞–ª–æ**:
- **1 –±–æ–ª—å—à–æ–π JOIN –∑–∞–ø—Ä–æ—Å** –ø–æ–ª—É—á–∞–µ—Ç –≤—Å—ë —Å—Ä–∞–∑—É
- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –ø–∞–º—è—Ç–∏ (–±—ã—Å—Ç—Ä–æ)
- –ò—Ç–æ–≥–æ: **1 –∑–∞–ø—Ä–æ—Å –∫ –ë–î** ‚ö°

**–û–∂–∏–¥–∞–µ–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç**:
- –°–º–µ—Ç–∞ —Å 100 –ø–æ–∑–∏—Ü–∏—è–º–∏: **10x –±—ã—Å—Ç—Ä–µ–µ** (—Å 3-5 —Å–µ–∫ ‚Üí 300-500ms)
- –ú–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –ë–î
- –ú–µ–Ω—å—à–µ network roundtrips

---

## üß™ –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç

```bash
# 1. –ù–∞–π–¥–∏—Ç–µ ID —Å–º–µ—Ç—ã –≤ –ë–î (—á–µ—Ä–µ–∑ –ª—é–±–æ–π SQL –∫–ª–∏–µ–Ω—Ç)
# SELECT id, name, tenant_id FROM estimates LIMIT 1;

# 2. –ó–∞–ø—É—Å—Ç–∏—ÇÔøΩÔøΩ —Ç–µ—Å—Ç
node scripts/test-estimate-load.mjs <estimate_id> <tenant_id>
```

**–•–æ—Ä–æ—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: < 500ms  
**–û—Ç–ª–∏—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: < 300ms

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ API

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
npm run dev

# –í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ - –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ curl/Postman
# GET /api/estimates/:id
# Authorization: Bearer <your_token>

# –°–º–æ—Ç—Ä–∏—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª–∏ —Å–µ—Ä–≤–µ—Ä–∞ –ª–æ–≥:
# [findByIdWithDetails] ‚úÖ Loaded estimate with 50 items in 250ms (optimized query)
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ß–µ—Ä–µ–∑ frontend

1. –ó–∞–ø—É—Å—Ç–∏—Ç—å `npm run dev`
2. –û—Ç–∫—Ä—ã—Ç—å —Å–º–µ—Ç—É –≤ –±—Ä–∞—É–∑–µ—Ä–µ
3. –û—Ç–∫—Ä—ã—Ç—å DevTools ‚Üí Network
4. –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
5. –ù–∞–π—Ç–∏ –∑–∞–ø—Ä–æ—Å `GET /api/estimates/:id`
6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å < 500ms)

---

## üîÑ –û—Ç–∫–∞—Ç (–µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫)

–°–æ–∑–¥–∞–Ω –±—ç–∫–∞–ø –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª–∞:
```bash
# –û—Ç–∫–∞—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
Copy-Item "server\repositories\estimatesRepository.js.backup" "server\repositories\estimatesRepository.js" -Force

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
npm run dev
```

---

## üìä –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### ‚úÖ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

- [ ] –°–º–µ—Ç–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –í—Å–µ –ø–æ–∑–∏—Ü–∏–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è
- [ ] –í—Å–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã —É –ø–æ–∑–∏—Ü–∏–π –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è
- [ ] –¶–µ–Ω—ã –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ
- [ ] –ò—Ç–æ–≥–æ–≤–∞—è —Å—É–º–º–∞ —Å–æ–≤–ø–∞–¥–∞–µ—Ç

### ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- [ ] –í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ < 500ms (—Å–º–æ—Ç—Ä–µ—Ç—å –≤ –∫–æ–Ω—Å–æ–ª–∏ —Å–µ—Ä–≤–µ—Ä–∞)
- [ ] –¢–æ–ª—å–∫–æ 1 SQL –∑–∞–ø—Ä–æ—Å –≤–º–µ—Å—Ç–æ N+2
- [ ] Network payload –Ω–µ —É–≤–µ–ª–∏—á–∏–ª—Å—è –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ

### ‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

**–ü—Ä–æ–±–ª–µ–º–∞**: –°–º–µ—Ç–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è  
**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –æ—à–∏–±–∫–∏ SQL

**–ü—Ä–æ–±–ª–µ–º–∞**: –ú–∞—Ç–µ—Ä–∏–∞–ª—ã –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è  
**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å ID –≤ –ë–î

**–ü—Ä–æ–±–ª–µ–º–∞**: –ú–µ–¥–ª–µ–Ω–Ω–µ–µ —á–µ–º –±—ã–ª–æ  
**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã –Ω–∞ —Ç–∞–±–ª–∏—Ü–∞—Ö (estimate_items, estimate_item_materials)

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–§–∞–∑–∞ 2)

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –§–∞–∑—ã 1:

1. **–î–æ–±–∞–≤–∏—Ç—å SWR –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** (frontend)
   - –û–±–µ—Ä–Ω—É—Ç—å API –≤—ã–∑–æ–≤—ã –≤ `useSWR`
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å revalidation

2. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å `/api/search/pinecone`**
   - Batch queries —Å `WHERE IN`

3. **Bundle optimization**
   - Code splitting
   - Tree shaking

---

## üìù –ó–∞–º–µ—Ç–∫–∏

- –ë—ç–∫–∞–ø —Ñ–∞–π–ª–∞: `server/repositories/estimatesRepository.js.backup`
- –ù–æ–≤—ã–π –∫–æ–¥ –ø–æ–º–µ—á–µ–Ω –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏ `‚úÖ –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø`
- –î–æ–±–∞–≤–ª–µ–Ω —Ç–∞–π–º–µ—Ä –¥–ª—è –∏–∑–º–µ—Ä–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–≥—Ä—É–∑–∫–∏
- –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –≤—Ä–µ–º—è –≤ –∫–æ–Ω—Å–æ–ª–∏ —Å–µ—Ä–≤–µ—Ä–∞

---

**–ê–≤—Ç–æ—Ä**: Antigravity AI  
**–î–∞—Ç–∞**: 8 —è–Ω–≤–∞—Ä—è 2026, 20:40
