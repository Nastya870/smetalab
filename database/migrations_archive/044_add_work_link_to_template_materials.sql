-- ============================================================================
-- Migration 044: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–≤—è–∑–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ —Å —Ä–∞–±–æ—Ç–∞–º–∏ –≤ —à–∞–±–ª–æ–Ω–∞—Ö
-- –û–ø–∏—Å–∞–Ω–∏–µ: –ú–∞—Ç–µ—Ä–∏–∞–ª—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º —Ä–∞–±–æ—Ç–∞–º, –∞ –Ω–µ –±—ã—Ç—å –æ–±—â–∏–º–∏
-- –î–∞—Ç–∞: 17 –Ω–æ—è–±—Ä—è 2025 –≥.
-- –í–µ—Ä—Å–∏—è: 1.0
-- ============================================================================

-- –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª–µ –¥–ª—è —Å–≤—è–∑–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∞ —Å —Ä–∞–±–æ—Ç–æ–π –≤ —à–∞–±–ª–æ–Ω–µ
ALTER TABLE estimate_template_materials
ADD COLUMN template_work_id UUID REFERENCES estimate_template_works(id) ON DELETE CASCADE;

-- –°–æ–∑–¥–∞–µ–º –∏–Ω–¥–µ–∫—Å –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã
CREATE INDEX IF NOT EXISTS idx_estimate_template_materials_work_id 
ON estimate_template_materials(template_work_id);

-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –ø–æ–ª—é
COMMENT ON COLUMN estimate_template_materials.template_work_id IS 'ID —Ä–∞–±–æ—Ç—ã –≤ —à–∞–±–ª–æ–Ω–µ, –∫ –∫–æ—Ç–æ—Ä–æ–π –ø—Ä–∏–≤—è–∑–∞–Ω –º–∞—Ç–µ—Ä–∏–∞–ª';

-- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
DO $$ 
BEGIN
  RAISE NOTICE '‚úÖ Migration 044: –ü–æ–ª–µ template_work_id –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ estimate_template_materials';
  RAISE NOTICE 'üîó –¢–µ–ø–µ—Ä—å –º–∞—Ç–µ—Ä–∏–∞–ª—ã –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º —Ä–∞–±–æ—Ç–∞–º –≤ —à–∞–±–ª–æ–Ω–µ';
  RAISE NOTICE 'üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –±–µ–∑ template_work_id –±—É–¥—É—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–º–∏';
END $$;
