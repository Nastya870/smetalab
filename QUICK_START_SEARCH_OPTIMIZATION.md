# üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ–∏—Å–∫–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤

## ‚úÖ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

–ü–æ–∏—Å–∫ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ —É—Å–∫–æ—Ä–µ–Ω **–≤ 6-10 —Ä–∞–∑** (—Å 1.5-2 —Å–µ–∫ –¥–æ 0.2-0.3 —Å–µ–∫) —á–µ—Ä–µ–∑:
1. **PostgreSQL** - pg_trgm GIN –∏–Ω–¥–µ–∫—Å—ã
2. **Backend** - —Ç—Ä–∏–≥—Ä–∞–º–º–Ω—ã–π –ø–æ–∏—Å–∫ + —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏
3. **Frontend** - debounced —Å–µ—Ä–≤–µ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ –≤–º–µ—Å—Ç–æ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

## üìù –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

### 1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –ë–î (5 –º–∏–Ω—É—Ç)

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –±–∞–∑–µ (Neon)
psql your_database_url

# –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
\i database/migrations/052_optimize_materials_search.sql

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã (–¥–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å 3 –∏–Ω–¥–µ–∫—Å–∞)
\di idx_materials_*trgm
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
                           List of relations
 Schema |            Name             | Type  |  Owner  |    Table
--------+-----------------------------+-------+---------+-------------
 public | idx_materials_name_trgm     | index | user    | materials
 public | idx_materials_sku_trgm      | index | user    | materials
 public | idx_materials_supplier_trgm | index | user    | materials
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞ (—É–∂–µ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã)

–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã:
- ‚úÖ `server/controllers/materialsController.js` - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π SQL
- ‚úÖ `app/estimates/EstimateWithSidebar.jsx` - debounced –ø–æ–∏—Å–∫

### 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—É—â–∏–π –ø—Ä–æ—Ü–µ—Å—Å (Ctrl+C)

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
npm run dev
```

### 4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å (2 –º–∏–Ω—É—Ç—ã)

1. –û—Ç–∫—Ä—ã—Ç—å —Å–º–µ—Ç—É
2. –ù–∞–∂–∞—Ç—å "–î–æ–±–∞–≤–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª" –Ω–∞ –ª—é–±–æ–π —Ä–∞–±–æ—Ç–µ
3. –ù–∞—á–∞—Ç—å –≤–≤–æ–¥–∏—Ç—å "—Ü–µ–º" –∏–ª–∏ "–±–µ—Ç"
4. **–û–∂–∏–¥–∞–Ω–∏–µ:** –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ—è–≤—è—Ç—Å—è –∑–∞ **< 0.5 —Å–µ–∫—É–Ω–¥—ã**

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ DevTools Console:**
```
‚úÖ –ú–∞—Ç–µ—Ä–∏–∞–ª—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã: 187ms | —Å—Ç—Ä–∞–Ω–∏—Ü–∞ 1 | –∑–∞–ø–∏—Å–µ–π 100 | –≤—Å–µ–≥–æ 347
```

## üéØ –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞

| –¢–µ—Å—Ç | –û–∂–∏–¥–∞–Ω–∏–µ | –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å |
|------|----------|---------------|
| –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ | < 500ms | –í–≤–µ—Å—Ç–∏ "—Ü–µ–º–µ–Ω—Ç" ‚Üí –∑–∞—Å–µ—á—å –≤—Ä–µ–º—è |
| –ê–≤—Ç–æ–ø–æ–∏—Å–∫ | –ë–µ–∑ –∫–Ω–æ–ø–æ–∫ | –ü—Ä–æ—Å—Ç–æ –ø–µ—á–∞—Ç–∞—Ç—å, –Ω–µ –Ω–∞–∂–∏–º–∞—Ç—å –Ω–∏—á–µ–≥–æ |
| –†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å | –¢–æ—á–Ω—ã–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è —Å–≤–µ—Ä—Ö—É | –í–≤–µ—Å—Ç–∏ "MAT-001" ‚Üí –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–µ—Ä–≤—ã–º |
| –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å | –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ 47k | –í–≤–µ—Å—Ç–∏ –æ–±—â–µ–µ —Å–ª–æ–≤–æ "–º–∞—Ç–µ—Ä–∏–∞–ª" ‚Üí –¥–æ–ª–∂–Ω–æ –Ω–∞–π—Ç–∏ –±—ã—Å—Ç—Ä–æ |

## ‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞ 1: "extension pg_trgm does not exist"
```bash
# –†–µ—à–µ–Ω–∏–µ: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –≤—Ä—É—á–Ω—É—é
psql your_database_url
CREATE EXTENSION IF NOT EXISTS pg_trgm;
```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: "–ò–Ω–¥–µ–∫—Å—ã –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è"
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞
SELECT current_user, current_database();

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ pg_trgm
SELECT * FROM pg_extension WHERE extname = 'pg_trgm';
```

### –ü—Ä–æ–±–ª–µ–º–∞ 3: "–ü–æ–∏—Å–∫ –≤—Å—ë –µ—â—ë –º–µ–¥–ª–µ–Ω–Ω—ã–π"
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤
EXPLAIN ANALYZE 
SELECT * FROM materials 
WHERE LOWER(name) % '–±–µ—Ç–æ–Ω';

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: "Bitmap Index Scan on idx_materials_name_trgm"
# Execution Time: < 50ms
```

## üìä –ú–µ—Ç—Ä–∏–∫–∏ "–¥–æ/–ø–æ—Å–ª–µ"

```
–î–û –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
  –ü–æ–∏—Å–∫ ILIKE:        800-1200ms  ‚ùå
  –û–±—â–µ–µ –≤—Ä–µ–º—è:        1.5-2 —Å–µ–∫   ‚ùå
  
–ü–û–°–õ–ï –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
  –ü–æ–∏—Å–∫ pg_trgm:      10-50ms     ‚úÖ
  –û–±—â–µ–µ –≤—Ä–µ–º—è:        0.2-0.3 —Å–µ–∫ ‚úÖ
  
–£–õ–£–ß–®–ï–ù–ò–ï:            6-10x       üéâ
```

## üìö –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏

–°–º. –ø–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç: `MATERIALS_SEARCH_OPTIMIZATION_REPORT.md`

---

**–í—Ä–µ–º—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è:** ~5-10 –º–∏–Ω—É—Ç  
**–≠—Ñ—Ñ–µ–∫—Ç:** –ü–æ–∏—Å–∫ –≤ 6-10 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ  
**–ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É:** ‚úÖ –î–∞
