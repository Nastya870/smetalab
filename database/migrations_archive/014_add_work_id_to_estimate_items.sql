-- ============================================================================
-- Migration 014: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ work_id –≤ estimate_items
-- –û–ø–∏—Å–∞–Ω–∏–µ: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–≤—è–∑–∏ —Å —Ä–∞–±–æ—Ç–æ–π –∏–∑ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–µ–π
-- –î–∞—Ç–∞: 14 –æ–∫—Ç—è–±—Ä—è 2025 –≥.
-- –í–µ—Ä—Å–∏—è: 1.0
-- ============================================================================

-- –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª–µ work_id (nullable, —Ç–∞–∫ –∫–∞–∫ –º–æ–≥—É—Ç –±—ã—Ç—å —Ä—É—á–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏)
ALTER TABLE estimate_items
ADD COLUMN work_id INTEGER REFERENCES works(id) ON DELETE SET NULL;

-- –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω–¥–µ–∫—Å –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø–æ–∏—Å–∫–∞
CREATE INDEX idx_estimate_items_work_id ON estimate_items(work_id);

-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –ø–æ–ª—é
COMMENT ON COLUMN estimate_items.work_id IS 'ID —Ä–∞–±–æ—Ç—ã –∏–∑ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ (NULL –¥–ª—è —Ä—É—á–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π)';

-- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
DO $$ 
BEGIN
  RAISE NOTICE '‚úÖ Migration 014: –ü–æ–ª–µ work_id –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ estimate_items';
  RAISE NOTICE 'üîó –¢–µ–ø–µ—Ä—å –º—ã –ø–æ–º–Ω–∏–º, –∏–∑ –∫–∞–∫–æ–π —Ä–∞–±–æ—Ç—ã —Å–æ–∑–¥–∞–Ω–∞ –ø–æ–∑–∏—Ü–∏—è';
  RAISE NOTICE 'üîí –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞—Ö–æ–¥–∞';
END $$;
