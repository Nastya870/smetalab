# ü§ñ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –∏–∑ —à–∞–±–ª–æ–Ω–æ–≤

## üìã –ü—Ä–æ–±–ª–µ–º–∞

–†–∞–Ω—å—à–µ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–º–µ—Ç—ã –∏–∑ —à–∞–±–ª–æ–Ω–∞:
- **–®–∞–±–ª–æ–Ω**: –†–∞–±–æ—Ç–∞ 100 –º¬≤ ‚Üí –ö–ª–µ–π 15 —à—Ç (—Ä–∞—Å—Å—á–∏—Ç–∞–Ω–æ –≤—Ä—É—á–Ω—É—é)
- **–ù–æ–≤–∞—è —Å–º–µ—Ç–∞**: –†–∞–±–æ—Ç–∞ 50 –º¬≤ ‚Üí –ö–ª–µ–π –≤—Å—ë —Ä–∞–≤–Ω–æ 15 —à—Ç ‚ùå (–Ω–µ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è)

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

–¢–µ–ø–µ—Ä—å —Å–∏—Å—Ç–µ–º–∞ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã—á–∏—Å–ª—è–µ—Ç –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Ä–∞—Å—Ö–æ–¥–∞** –ø—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ —à–∞–±–ª–æ–Ω–∞.

### –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

#### 1Ô∏è‚É£ **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞** (Backend)

–ö–æ–≥–¥–∞ —Å–æ–∑–¥–∞—ë—Ç—Å—è —Å–º–µ—Ç–∞ –∏–∑ —à–∞–±–ª–æ–Ω–∞, –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è:

```sql
consumption_coefficient = –º–∞—Ç–µ—Ä–∏–∞–ª_–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ / —Ä–∞–±–æ—Ç–∞_–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
auto_calculate = true
```

**–ü—Ä–∏–º–µ—Ä**:
- –†–∞–±–æ—Ç–∞ –≤ —à–∞–±–ª–æ–Ω–µ: **100 –º¬≤**
- –ö–ª–µ–π –≤ —à–∞–±–ª–æ–Ω–µ: **15 —à—Ç**
- **–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç**: 15 / 100 = **0.15**

```javascript
// server/controllers/estimateTemplatesController.js (—Å—Ç—Ä–æ–∫–∞ 473-489)
INSERT INTO estimate_item_materials (
  consumption_coefficient,
  auto_calculate
)
SELECT 
  CASE 
    WHEN etw.quantity > 0 THEN etm.quantity / etw.quantity
    ELSE 1.0
  END,
  true
FROM estimate_template_materials etm
JOIN estimate_template_works etw ON etm.template_work_id = etw.id
```

#### 2Ô∏è‚É£ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Å—á—ë—Ç** (Frontend)

–ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ä–∞–±–æ—Ç—ã –º–∞—Ç–µ—Ä–∏–∞–ª—ã –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è:

```javascript
// app/estimates/EstimateWithSidebar.jsx (—Å—Ç—Ä–æ–∫–∞ 1183-1197)
if (material.auto_calculate === true) {
  newQuantity = —Ä–∞–±–æ—Ç–∞_–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ √ó consumption_coefficient
  
  // –ü—Ä–∏–º–µ—Ä: 50 –º¬≤ √ó 0.15 = 7.5 —à—Ç
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Ç–∞–±–ª–∏—Ü–µ**:
| –†–∞–±–æ—Ç–∞ | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ | –ú–∞—Ç–µ—Ä–∏–∞–ª | –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç | –ö–æ–ª-–≤–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞ |
|--------|-----------|----------|-------------|------------------|
| –ú–æ–Ω—Ç–∞–∂ | **50 –º¬≤** | –ö–ª–µ–π | 0.15 | **7.5 —à—Ç** ‚úÖ |
| –ú–æ–Ω—Ç–∞–∂ | **100 –º¬≤** | –ö–ª–µ–π | 0.15 | **15 —à—Ç** ‚úÖ |
| –ú–æ–Ω—Ç–∞–∂ | **200 –º¬≤** | –ö–ª–µ–π | 0.15 | **30 —à—Ç** ‚úÖ |

### üìä –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ UI

**–ö–æ–ª–æ–Ω–∫–∞ "–†–∞—Å—Ö–æ–¥"** —Ç–µ–ø–µ—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—ã—á–∏—Å–ª–µ–Ω–Ω—ã–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç:
- **0.15** - –Ω–∞ –∫–∞–∂–¥—É—é –µ–¥–∏–Ω–∏—Ü—É —Ä–∞–±–æ—Ç—ã –Ω—É–∂–Ω–æ 0.15 –µ–¥–∏–Ω–∏—Ü –º–∞—Ç–µ—Ä–∏–∞–ª–∞
- –ú–æ–∂–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞ **0.2** –¥–ª—è –∑–∞–ø–∞—Å–∞)

### üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

#### Backend:
1. **estimateTemplatesController.js**:
   - –í—ã—á–∏—Å–ª–µ–Ω–∏–µ `consumption_coefficient` –ø—Ä–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏ –∏–∑ —à–∞–±–ª–æ–Ω–∞
   - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ `auto_calculate = true`

2. **estimatesRepository.js**:
   - SELECT —Ç–µ–ø–µ—Ä—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `auto_calculate`
   - INSERT —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç `auto_calculate`

3. **estimateItemsRepository.js**:
   - –í—Å–µ INSERT –∑–∞–ø—Ä–æ—Å—ã –≤–∫–ª—é—á–∞—é—Ç `auto_calculate`

#### Frontend:
–õ–æ–≥–∏–∫–∞ —É–∂–µ –±—ã–ª–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ä–∞–Ω–µ–µ:
- –ú–∞—Ç–µ—Ä–∏–∞–ª—ã —Å `auto_calculate = true` –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –ú–∞—Ç–µ—Ä–∏–∞–ª—ã —Å `auto_calculate = false` –æ—Å—Ç–∞—é—Ç—Å—è —Å—Ç–∞—Ç–∏—á–Ω—ã–º–∏ (—Ä—É—á–Ω–æ–π –≤–≤–æ–¥)

### üéØ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

#### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –°–æ–∑–¥–∞–Ω–∏–µ —Å–º–µ—Ç—ã –∏–∑ —à–∞–±–ª–æ–Ω–∞
1. –í—ã–±–∏—Ä–∞–µ–º —à–∞–±–ª–æ–Ω "–û—Ç–¥–µ–ª–∫–∞ –ø–æ–º–µ—â–µ–Ω–∏—è"
2. –í —à–∞–±–ª–æ–Ω–µ: –®—Ç—É–∫–∞—Ç—É—Ä–∫–∞ 100 –º¬≤ ‚Üí –°–º–µ—Å—å 150 –∫–≥ (–∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç 1.5)
3. –ü—Ä–∏–º–µ–Ω—è–µ–º –∫ –ø—Ä–æ–µ–∫—Ç—É –ø–ª–æ—â–∞–¥—å—é 60 –º¬≤
4. **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –®—Ç—É–∫–∞—Ç—É—Ä–∫–∞ 60 –º¬≤ ‚Üí –°–º–µ—Å—å **90 –∫–≥** (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

#### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è
1. –ò–∑–º–µ–Ω—è–µ–º –ø–ª–æ—â–∞–¥—å —Ä–∞–±–æ—Ç—ã —Å 60 –º¬≤ –Ω–∞ 75 –º¬≤
2. **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –°–º–µ—Å—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Å—á–∏—Ç–∞–µ—Ç—Å—è –Ω–∞ **112.5 –∫–≥**

#### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –†—É—á–Ω–∞—è –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞
1. –í–∏–¥–∏–º –≤ –∫–æ–ª–æ–Ω–∫–µ "–†–∞—Å—Ö–æ–¥" –∑–Ω–∞—á–µ–Ω–∏–µ **1.5**
2. –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º –Ω–∞ **1.8** (–¥–æ–±–∞–≤–ª—è–µ–º –∑–∞–ø–∞—Å)
3. –ü—Ä–∏ 75 –º¬≤ –ø–æ–ª—É—á–∏–º: **135 –∫–≥** –≤–º–µ—Å—Ç–æ 112.5 –∫–≥

### üõ°Ô∏è –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

- ‚úÖ **–°—Ç–∞—Ä—ã–µ —Å–º–µ—Ç—ã** - –Ω–µ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—é—Ç—Å—è, —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ
- ‚úÖ **–†—É—á–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã** - –µ—Å–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤—Ä—É—á–Ω—É—é (–Ω–µ –∏–∑ —à–∞–±–ª–æ–Ω–∞), `auto_calculate = false`
- ‚úÖ **–®–∞–±–ª–æ–Ω—ã** - –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ —à–∞–±–ª–æ–Ω–∞ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –∑–∞–Ω–æ–≤–æ

### üìà –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. **–≠–∫–æ–Ω–æ–º–∏—è –≤—Ä–µ–º–µ–Ω–∏** - –Ω–µ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª—ã –≤—Ä—É—á–Ω—É—é
2. **–¢–æ—á–Ω–æ—Å—Ç—å** - –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –≤—ã—á–∏—Å–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
3. **–ì–∏–±–∫–æ—Å—Ç—å** - –º–æ–∂–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –≤—Ä—É—á–Ω—É—é
4. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –ª–µ–≥–∫–æ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–º–µ—Ç—ã –ø–æ–¥ —Ä–∞–∑–Ω—ã–µ –æ–±—ä—ë–º—ã

---

**–í–µ—Ä—Å–∏—è**: 1.0  
**–î–∞—Ç–∞**: 27 –¥–µ–∫–∞–±—Ä—è 2025 –≥.  
**–ö–æ–º–º–∏—Ç**: `912fda5`
