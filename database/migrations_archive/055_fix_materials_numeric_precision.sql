-- ============================================
-- МИГРАЦИЯ: Исправление numeric overflow в materials
-- Дата: 28.12.2025
-- Описание: Увеличение precision для price (10,2 → 12,2)
-- Причина: Ошибка "precision 10, scale 2 must be < 10^8" в getMaterialsStats
-- ============================================

-- БЕЗОПАСНАЯ ОПЕРАЦИЯ: Увеличение precision не требует пересчёта данных
-- PostgreSQL автоматически сохранит все существующие значения

-- Увеличиваем precision для price с 10 до 12 знаков
-- Это позволит хранить значения до 9,999,999,999.99 вместо 99,999,999.99
ALTER TABLE materials 
  ALTER COLUMN price TYPE DECIMAL(12, 2);

-- Комментарий для документации
COMMENT ON COLUMN materials.price IS 'Цена материала (макс. 9,999,999,999.99). DECIMAL(12,2) для избежания overflow в агрегатах.';
