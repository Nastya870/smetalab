# üìä SmetaLab ‚Äî –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–º–∏ —Å–º–µ—Ç–∞–º–∏

**–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è SaaS-–ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–º–∏ –ø—Ä–æ–µ–∫—Ç–∞–º–∏, —Å–º–µ—Ç–∞–º–∏ –∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏**

[![Version](https://img.shields.io/badge/version-v6.2.0-blue.svg)](./package.json)
[![Node](https://img.shields.io/badge/node-%3E%3D18.0.0-brightgreen.svg)](https://nodejs.org/)
[![License](https://img.shields.io/badge/license-Proprietary-red.svg)](./LICENSE)

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **Node.js** 18+ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 20+)
- **PostgreSQL** 14+
- **npm** –∏–ª–∏ **yarn** (–≤ –ø—Ä–æ–µ–∫—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Yarn 4)

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone https://github.com/Nastya870/smetalab.git
cd "smetalab v6"

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
npm install
# –∏–ª–∏
yarn install

# –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
cp .env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å .env - –¥–æ–±–∞–≤–∏—Ç—å DATABASE_URL –∏ API –∫–ª—é—á–∏

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
npm run db:migrate

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (frontend + backend –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ)
npm run dev
```

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –Ω–∞:
- **Frontend**: `http://localhost:3000`
- **Backend API**: `http://localhost:3001`
- **API Docs**: `http://localhost:3001/api-docs` (Swagger)

---

## üì¶ –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### üèóÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞–º–∏
- –°–æ–∑–¥–∞–Ω–∏–µ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤
- –ú–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –¥–æ—Å—Ç—É–ø —Å —Ä–∞–∑–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –ø—Ä–∞–≤ (RBAC)
- –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

### üìã –°–º–µ—Ç—ã
- –°–æ–∑–¥–∞–Ω–∏–µ —Å–º–µ—Ç –∏–∑ —à–∞–±–ª–æ–Ω–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –∏ —Ä–∞–±–æ—Ç
- –†–∞—Å—á—ë—Ç –≤–µ—Å–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ (–¥–ª—è –º–µ—Ç–∞–ª–ª–æ–∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–π)
- –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel, PDF, Word

### üìö –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏
- **–ú–∞—Ç–µ—Ä–∏–∞–ª—ã**: 4-—É—Ä–æ–≤–Ω–µ–≤—ã–π –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–π –∫–∞—Ç–∞–ª–æ–≥ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ —Å —Ü–µ–Ω–∞–º–∏ (–≥–ª–æ–±–∞–ª—å–Ω—ã–π + —Ç–µ–Ω–∞–Ω—Ç)
- **–†–∞–±–æ—Ç—ã**: —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã—Ö —Ä–∞–±–æ—Ç —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- **–ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—ã**: –ø–æ—Å—Ç–∞–≤—â–∏–∫–∏ –∏ –ø–æ–¥—Ä—è–¥—á–∏–∫–∏
- –ò–º–ø–æ—Ä—Ç –∏–∑ CSV/Excel

### üîç –ü–æ–∏—Å–∫
- **–õ–æ–∫–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫**: –ë—ã—Å—Ç—Ä–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ —Å –ø–æ–ª–Ω—ã–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∏–µ—Ä–∞—Ä—Ö–∏–∏ (—ç—Ç–∞–ø—ã, —Ä–∞–∑–¥–µ–ª—ã)
- **Smart Search (Legacy)**: *–†–∞–Ω–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞—Å—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OpenAI –∏ Pinecone (–æ—Ç–∫–ª—é—á–µ–Ω–∞ –≤ v4.1.2 –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –∏ —Å–∫–æ—Ä–æ—Å—Ç–∏)*

### üìÑ –ó–∞–∫—É–ø–∫–∏
- –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–æ–∫ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–º–µ—Ç
- –ü–∞—Ä—Å–∏–Ω–≥ –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö —á–µ—Ä–µ–∑ AI (Tesseract OCR + OpenAI)
- –°–≤–µ—Ä–∫–∞ —Ü–µ–Ω –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- JWT-–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (access + refresh tokens)
- –ú—É–ª—å—Ç–∏-—Ç–µ–Ω–∞–Ω—Ç–Ω–æ—Å—Ç—å —Å –∏–∑–æ–ª—è—Ü–∏–µ–π –¥–∞–Ω–Ω—ã—Ö
- –†–æ–ª–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ (super_admin, admin, estimator, viewer, –∏ —Ç.–¥.) —Å –∂–µ—Å—Ç–∫–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –≥—Ä–∞–Ω–∏—Ü
- –£–º–Ω—ã–π Rate limiting —Å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–µ–π –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏ CORS protection

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### Tech Stack

**Frontend:**
- React 19 + React Router 7
- Material-UI 7 (MUI)
- Vite 6
- Formik + Yup (—Ñ–æ—Ä–º—ã –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è)
- ApexCharts (–≥—Ä–∞—Ñ–∏–∫–∏)
- SWR (data fetching)

**Backend:**
- Express 5
- PostgreSQL 14+ (Render)
- JWT Authentication
- OpenAI API (—É–º–Ω—ã–π –ø–æ–∏—Å–∫, OCR)
- Pinecone (vector database)
- Voyage AI (embeddings)

**DevOps:**
**DevOps:**
- **Frontend**: Vercel (–∞–≤—Ç–æ–¥–µ–ø–ª–æ–π —Å GitHub)
- **Backend**: Render Web Service (Frankfurt)
- **Database**: Render PostgreSQL (Frankfurt)
- **CI/CD**: GitHub Actions (Unit —Ç–µ—Å—Ç—ã –ø—Ä–∏ push, Linting), Playwright (E2E —Ç–µ—Å—Ç—ã)

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
smetalab v6/
‚îú‚îÄ‚îÄ app/                          # React –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ admin/                    # –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
‚îÇ   ‚îú‚îÄ‚îÄ estimates/                # –ú–æ–¥—É–ª—å —Å–º–µ—Ç
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ components/           # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–º–µ—Ç (—Ç–∞–±–ª–∏—Ü—ã, —Ñ–æ—Ä–º—ã)
‚îÇ   ‚îú‚îÄ‚îÄ projects/                 # –ú–æ–¥—É–ª—å –ø—Ä–æ–µ–∫—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ references/               # –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ (–º–∞—Ç–µ—Ä–∏–∞–ª—ã, —Ä–∞–±–æ—Ç—ã)
‚îÇ   ‚îú‚îÄ‚îÄ purchases/                # –ú–æ–¥—É–ª—å –∑–∞–∫—É–ø–æ–∫
‚îÇ   ‚îú‚îÄ‚îÄ dashboard/                # –î–∞—à–±–æ—Ä–¥ —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π
‚îÇ   ‚îú‚îÄ‚îÄ layout/                   # –û—Å–Ω–æ–≤–Ω–æ–π layout (header, sidebar)
‚îÇ   ‚îî‚îÄ‚îÄ routes/                   # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–∞—Ä—à—Ä—É—Ç–æ–≤

‚îú‚îÄ‚îÄ server/                       # Express Backend
‚îÇ   ‚îú‚îÄ‚îÄ controllers/              # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ services/                 # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ smartSearchService.js # AI-–ø–æ–∏—Å–∫ —Å OpenAI
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ semanticSearchService.js # Semantic search
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ hybridSearchService.js   # Hybrid search
‚îÇ   ‚îú‚îÄ‚îÄ repositories/             # Data access layer
‚îÇ   ‚îú‚îÄ‚îÄ middleware/               # Auth, RBAC, rate limiting
‚îÇ   ‚îî‚îÄ‚îÄ routes/                   # API endpoints

‚îú‚îÄ‚îÄ shared/                       # –û–±—â–∏–π –∫–æ–¥
‚îÇ   ‚îî‚îÄ‚îÄ lib/
‚îÇ       ‚îú‚îÄ‚îÄ contexts/             # React contexts (Auth, Theme)
‚îÇ       ‚îú‚îÄ‚îÄ hooks/                # Custom hooks
‚îÇ       ‚îú‚îÄ‚îÄ api/                  # API –∫–ª–∏–µ–Ω—Ç—ã
‚îÇ       ‚îî‚îÄ‚îÄ utils/                # –£—Ç–∏–ª–∏—Ç—ã

‚îú‚îÄ‚îÄ database/                     # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ migrations/               # SQL –º–∏–≥—Ä–∞—Ü–∏–∏ (052 —Ñ–∞–π–ª–æ–≤)
‚îÇ   ‚îú‚îÄ‚îÄ seeds/                    # –°—Ç–∞—Ä—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
‚îÇ   ‚îî‚îÄ‚îÄ README.md                 # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å—Ö–µ–º—ã –ë–î

‚îú‚îÄ‚îÄ tests/                        # –¢–µ—Å—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ unit/                     # Unit —Ç–µ—Å—Ç—ã (140+ —Ç–µ—Å—Ç–æ–≤)
‚îÇ   ‚îú‚îÄ‚îÄ integration/              # Integration —Ç–µ—Å—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ security/                 # Security —Ç–µ—Å—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ production/               # Smoke —Ç–µ—Å—Ç—ã –¥–ª—è production
‚îÇ   ‚îî‚îÄ‚îÄ e2e/                      # E2E —Ç–µ—Å—Ç—ã (Playwright)

‚îú‚îÄ‚îÄ scripts/                      # –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ runMigrations.js          # –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ backup-neon-to-file.mjs   # –ë—ç–∫–∞–ø –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ test-smart-search.mjs     # –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ AI-–ø–æ–∏—Å–∫–∞
‚îÇ   ‚îî‚îÄ‚îÄ ...

‚îú‚îÄ‚îÄ docs/                         # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ refactoring/              # –û—Ç—á—ë—Ç—ã —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞
‚îÇ   ‚îú‚îÄ‚îÄ technical/                # –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ operations/               # Operational runbooks
‚îÇ   ‚îî‚îÄ‚îÄ testing/                  # Testing guides

‚îú‚îÄ‚îÄ public/                       # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
‚îú‚îÄ‚îÄ coverage/                     # Test coverage reports
‚îú‚îÄ‚îÄ dist/                         # Production build

‚îú‚îÄ‚îÄ vite.config.mjs               # Vite –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ vitest.config.mjs             # Vitest –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ playwright.config.js          # Playwright –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ render.yaml                   # Render.com deployment
‚îî‚îÄ‚îÄ vercel.json                   # Vercel deployment
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã
npm test

# Unit —Ç–µ—Å—Ç—ã
npm run test:unit

# Integration —Ç–µ—Å—Ç—ã
npm run test:integration

# Security —Ç–µ—Å—Ç—ã
npm run test:security

# E2E —Ç–µ—Å—Ç—ã (Playwright)
npm run test:e2e

# Coverage –æ—Ç—á—ë—Ç
npm run test:coverage

# –¢–µ—Å—Ç—ã –≤ watch —Ä–µ–∂–∏–º–µ
npm run test:watch

# UI —Ç–µ—Å—Ç–æ–≤ (Vitest UI)
npm run test:ui
```

**–¢–µ–∫—É—â–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ**: 250+ unit —Ç–µ—Å—Ç–æ–≤, 50+ integration —Ç–µ—Å—Ç–æ–≤ (–≤–∫–ª—é—á–∞—è –ø—Ä–æ–≤–µ—Ä–∫—É –≥—Ä–∞–Ω–∏—Ü —Ä–æ–ª–µ–π), 240+ security —Ç–µ—Å—Ç–æ–≤, 28+ E2E —Ç–µ—Å—Ç–æ–≤ (Playwright).
–í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ (–Ø–Ω–≤–∞—Ä—å 2026).

---

## üõ†Ô∏è –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –ó–∞–ø—É—Å–∫ dev-–æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# Frontend + Backend –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
npm run dev

# –¢–æ–ª—å–∫–æ frontend (Vite)
npm run start

# –¢–æ–ª—å–∫–æ backend (Express)
npm run server

# Backend —Å –∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–æ–π (nodemon)
npm run dev:server
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

```bash
# –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Ä–æ–ª—è–º–∏
npm run db:users

# –ù–∞–∑–Ω–∞—á–∏—Ç—å super_admin —Ä–æ–ª—å
npm run db:set-admin user@example.com

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—Ä—É—á–Ω—É—é
npm run db:migrate

# –û—á–∏—Å—Ç–∏—Ç—å –ë–î (‚ö†Ô∏è –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ!)
npm run db:clear

# –ë—ç–∫–∞–ø –ë–î
npm run db:backup
```

### –õ–∏–Ω—Ç–∏–Ω–≥ –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# ESLint –ø—Ä–æ–≤–µ—Ä–∫–∞
npm run lint

# ESLint –∞–≤—Ç–æ—Ñ–∏–∫—Å
npm run lint:fix

# Prettier —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
npm run prettier
```

---

## üöÄ –î–µ–ø–ª–æ–π

### Production –æ–∫—Ä—É–∂–µ–Ω–∏–µ

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ | URL |
|-----------|-----------|-----|
| **Frontend** | Vercel | https://smeta-lab.ru |
| **Backend** | Render Web Service | https://api.smeta-lab.ru (alias to smetalab-backend.onrender.com) |
| **Database** | Render PostgreSQL | Frankfurt region |

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

**Backend (Render):**
```env
DATABASE_URL=postgresql://...
JWT_ACCESS_SECRET=your-secret
JWT_REFRESH_SECRET=your-secret
NODE_ENV=production
PORT=3001

# AI Services
OPENAI_API_KEY=sk-...
OPENAI_BASE_URL=https://...  # (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –ø—Ä–æ–∫—Å–∏)
PINECONE_API_KEY=pcsk_...
PINECONE_INDEX_NAME=smetalab-search
VOYAGE_API_KEY=pa-...

# Email (Resend)
RESEND_API_KEY=re_...
SENDER_EMAIL=noreply@smeta-lab.ru
```

**Frontend (Vercel):**
```env
VITE_API_URL=https://smetalab-backend.onrender.com
VITE_APP_NAME=–°–º–µ—Ç–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π

- **Vercel**: –∞–≤—Ç–æ–¥–µ–ø–ª–æ–π frontend –ø—Ä–∏ push –≤ `main/master`
- **Render**: **Strict CI/CD Gate** ‚Äî –¥–µ–ø–ª–æ–π –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è *—Ç–æ–ª—å–∫–æ* –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ –≤ GitHub Actions (via Deploy Hook).
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: –ú–∏–≥—Ä–∞—Ü–∏–∏ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –¥–µ–ø–ª–æ–µ backend

---

## üìö API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –û—Å–Ω–æ–≤–Ω—ã–µ endpoints

**–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:**
- `POST /api/auth/register` - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- `POST /api/auth/login` - –í—Ö–æ–¥
- `POST /api/auth/refresh` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
- `GET /api/auth/me` - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ

**–ú–∞—Ç–µ—Ä–∏–∞–ª—ã:**
- `GET /api/materials` - –°–ø–∏—Å–æ–∫ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
- `POST /api/materials` - –°–æ–∑–¥–∞—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª
- `PUT /api/materials/:id` - –û–±–Ω–æ–≤–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª
- `DELETE /api/materials/:id` - –£–¥–∞–ª–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª
- `POST /api/materials/import` - –ò–º–ø–æ—Ä—Ç –∏–∑ CSV/Excel

**–†–∞–±–æ—Ç—ã:**
- `GET /api/works` - –°–ø–∏—Å–æ–∫ —Ä–∞–±–æ—Ç
- `POST /api/works` - –°–æ–∑–¥–∞—Ç—å —Ä–∞–±–æ—Ç—É

**–ü–æ–∏—Å–∫ (AI):**
- `POST /api/search/smart` - Smart search (OpenAI)
- `POST /api/search/pinecone` - Semantic/Hybrid search

**–°–º–µ—Ç—ã:**
- `GET /api/estimates` - –°–ø–∏—Å–æ–∫ —Å–º–µ—Ç
- `POST /api/estimates` - –°–æ–∑–¥–∞—Ç—å —Å–º–µ—Ç—É
- `GET /api/estimates/:id/export/pdf` - –≠–∫—Å–ø–æ—Ä—Ç –≤ PDF
- `GET /api/estimates/:id/export/excel` - –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel

**Swagger UI**: `http://localhost:3001/api-docs`

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- JWT tokens (access: 15 –º–∏–Ω, refresh: 30 –¥–Ω–µ–π)
- Bcrypt –¥–ª—è —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π (10 rounds)
- HTTP-only cookies –¥–ª—è refresh tokens

### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (RBAC)
–†–æ–ª–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:
- `super_admin` - –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º–µ
- `admin` - –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –∫–æ–º–ø–∞–Ω–∏–∏ (tenant)
- `project_manager` - –ú–µ–Ω–µ–¥–∂–µ—Ä –ø—Ä–æ–µ–∫—Ç–æ–≤
- `estimator` - –°–º–µ—Ç—á–∏–∫
- `supplier` - –ü–æ—Å—Ç–∞–≤—â–∏–∫ (readonly –¥–ª—è –∫–∞—Ç–∞–ª–æ–≥–æ–≤)
- `viewer` - –ù–∞–±–ª—é–¥–∞—Ç–µ–ª—å (readonly)

39 –¥–µ—Ç–∞–ª—å–Ω—ã—Ö —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π (permissions) –¥–ª—è CRUD –æ–ø–µ—Ä–∞—Ü–∏–π –Ω–∞–¥ —Ä–µ—Å—É—Ä—Å–∞–º–∏.
**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ (v6):** Super Admin –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Ä–æ–ª–∏, Tenant Admin ‚Äî —Ç–æ–ª—å–∫–æ —Ä–æ–ª–∏ —Å–≤–æ–µ–π –∫–æ–º–ø–∞–Ω–∏–∏.

### Multi-tenancy
- –ü–æ–ª–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –∫–æ–º–ø–∞–Ω–∏—è–º–∏ (tenants)
- Row Level Security (RLS) –≤ PostgreSQL
- –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ + —Ç–µ–Ω–∞–Ω—Ç-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

### –ó–∞—â–∏—Ç–∞ API
- Rate limiting (100 req/15 –º–∏–Ω –Ω–∞ IP)
- CORS —Å whitelist –¥–æ–º–µ–Ω–æ–≤
- SQL injection protection (–ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã)
- XSS protection
- Helmet.js security headers
- **–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ª–∏–º–∏—Ç–æ–≤:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç DoS —á–µ—Ä–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π rate-limit –≤ ENV.

---

## ü§ñ AI-–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### Smart Search (Legacy / Disabled)
*–†–∞–Ω–µ–µ –≤ —Å–∏—Å—Ç–µ–º–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è AI-–ø–æ–∏—Å–∫, –Ω–æ –±—ã–ª –æ—Ç–∫–ª—é—á–µ–Ω –≤ –ø–æ–ª—å–∑—É –Ω–∞–¥–µ–∂–Ω–æ–≥–æ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ñ–∏–ª—å—Ç—Ä–∞.*
- **OpenAI GPT-4o-mini**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–ø–µ—á–∞—Ç–æ–∫ –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
- **Pinecone + Voyage AI**: –í–µ–∫—Ç–æ—Ä–Ω—ã–π —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫

### OCR –¥–ª—è –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö (Tesseract + OpenAI)
- –ü–∞—Ä—Å–∏–Ω–≥ –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö –æ—Ç –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –∏ —Ü–µ–Ω
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å –∫–∞—Ç–∞–ª–æ–≥–æ–º

---

## üìä –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
- `tenants` - –ö–æ–º–ø–∞–Ω–∏–∏
- `users` - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- `user_tenants` - –ß–ª–µ–Ω—Å—Ç–≤–æ –≤ –∫–æ–º–ø–∞–Ω–∏—è—Ö
- `roles`, `permissions`, `role_permissions` - RBAC
- `user_role_assignments` - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ä–æ–ª–µ–π
- `sessions` - –ê–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏
- `materials` - –ú–∞—Ç–µ—Ä–∏–∞–ª—ã (10,000+ –∑–∞–ø–∏—Å–µ–π)
- `works` - –†–∞–±–æ—Ç—ã (5,000+ –∑–∞–ø–∏—Å–µ–π)
- `projects` - –ü—Ä–æ–µ–∫—Ç—ã
- `estimates` - –°–º–µ—Ç—ã
- `estimate_items` - –ü–æ–∑–∏—Ü–∏–∏ —Å–º–µ—Ç
- `counterparties` - –ö–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—ã
- `purchase_requests` - –ó–∞—è–≤–∫–∏ –Ω–∞ –∑–∞–∫—É–ø–∫—É

### –ú–∏–≥—Ä–∞—Ü–∏–∏
61 –º–∏–≥—Ä–∞—Ü–∏—è –≤–∫–ª—é—á–∞—è:
- Schema creation (—Ç–∞–±–ª–∏—Ü—ã, –∏–Ω–¥–µ–∫—Å—ã, constraints)
- RLS setup (Row Level Security) - *–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –æ–±–ª–∞—á–Ω—ã–º–∏ –ë–î –±–µ–∑ –ø—Ä–∞–≤ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è*
- Seed data (—Ä–æ–ª–∏, —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è, –∫–∞—Ç–µ–≥–æ—Ä–∏–∏)
- Performance optimizations (GiST indexes –¥–ª—è –ø–æ–∏—Å–∫–∞)

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: [database/README.md](./database/README.md)

---

## üìÅ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [Database Schema](./database/README.md) - –°—Ö–µ–º–∞ –ë–î, –º–∏–≥—Ä–∞—Ü–∏–∏, RLS
- [Server API](./server/README.md) - Backend –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [Testing Guide](./tests/README.md) - –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- [Technical Docs](./docs/technical/) - –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [Refactoring Reports](./docs/refactoring/) - –ò—Å—Ç–æ—Ä–∏—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

---

## üîÑ CI/CD

### GitHub Actions
- ‚úÖ –õ–∏–Ω—Ç–∏–Ω–≥ –ø—Ä–∏ –∫–∞–∂–¥–æ–º PR
- ‚úÖ Unit —Ç–µ—Å—Ç—ã –ø—Ä–∏ –∫–∞–∂–¥–æ–º push
- ‚úÖ E2E —Ç–µ—Å—Ç—ã –ø–µ—Ä–µ–¥ –º–µ—Ä–∂–µ–º –≤ main
- ‚úÖ Security scan (–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏)

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–µ–ø–ª–æ–∏
- **Vercel**: –∞–≤—Ç–æ–¥–µ–ø–ª–æ–π frontend –ø—Ä–∏ push –≤ `main`
- **Render**: –∞–≤—Ç–æ–¥–µ–ø–ª–æ–π backend –ø—Ä–∏ push –≤ `main`
- **Rollback**: Vercel –∏ Render –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç –æ—Ç–∫–∞—Ç –∫ –ø—Ä–µ–¥—ã–¥—É—â–∏–º –≤–µ—Ä—Å–∏—è–º

---

## üêõ Troubleshooting

### –ü—Ä–æ–±–ª–µ–º—ã —Å Smart Search (OpenAI)

**–û—à–∏–±–∫–∞**: `403 Country, region, or territory not supported`

**–†–µ—à–µ–Ω–∏–µ**:
1. –í–∫–ª—é—á–∏—Ç—å VPN
2. –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ–∫—Å–∏ - –¥–æ–±–∞–≤–∏—Ç—å –≤ `.env`:
   ```env
   OPENAI_BASE_URL=https://api.proxyapi.ru/openai/v1
   ```

### –ü—Ä–æ–±–ª–µ–º—ã —Å –ë–î

**–û—à–∏–±–∫–∞**: `Connection timeout`

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å**:
1. –ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å `DATABASE_URL` –≤ `.env`
2. –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å PostgreSQL (–µ—Å–ª–∏ Render - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å)
3. SSL mode (`?sslmode=require` –¥–ª—è Render)

### Render backend "—Å–ø–∏—Ç" (free plan)

**–ü—Ä–æ–±–ª–µ–º–∞**: Backend –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –ø–µ—Ä–≤—ã–µ 30-60 —Å–µ–∫—É–Ω–¥

**–†–µ—à–µ–Ω–∏–µ**: Render free tier —É—Å—ã–ø–ª—è–µ—Ç –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã. –ü–µ—Ä–≤—ã–π –∑–∞–ø—Ä–æ—Å "–±—É–¥–∏—Ç" —Å–µ—Ä–≤–µ—Ä.

---

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

**Proprietary** - –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —è–≤–ª—è–µ—Ç—Å—è –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏–º –ø—Ä–æ–¥—É–∫—Ç–æ–º SmetaLab. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ, –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–ª–∏ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –±–µ–∑ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∑–∞–ø—Ä–µ—â–µ–Ω–æ.

---

## üë• –ö–æ–º–∞–Ω–¥–∞

**–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞**: SmetaLab Team  
**GitHub**: [@Nastya870](https://github.com/Nastya870)  
**–°–∞–π—Ç**: [smeta-lab.ru](https://smeta-lab.ru)

---

## üìÆ –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

- **Email**: support@smeta-lab.ru
- **Issues**: [GitHub Issues](https://github.com/Nastya870/smetalab/issues)
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: [docs/](./docs/)

---

**–í–µ—Ä—Å–∏—è**: v6.2.1  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 17 –Ø–Ω–≤–∞—Ä—è 2026 (Hierarchical Categories & Admin Cleanup Tools)
