# 📦 Изменения в UI управления справочником материалов

## 🎯 Цель изменений:
Аналогично справочнику работ - сделать управление глобальными и тенантными справочниками более понятным и безопасным.

---

## ✅ Что изменено:

### 1. **Кнопки управления перенесены и условно отображаются**

**Было:**
- Кнопки "Импорт" и "Добавить материал" были в шапке страницы
- Отображались **всегда**, независимо от выбранного фильтра
- Размер: обычный (большие кнопки)

**Стало:**
- Кнопки перенесены рядом с фильтром "Тип материалов"
- Отображаются **только когда выбран фильтр "Мои" (🏢)**
- Размер: `small` (компактные кнопки)
- Текст кнопки изменен: "Добавить материал" → "Добавить"

---

## 🎨 Визуальная структура:

```
┌─────────────────────────────────────────────────────────┐
│  Справочник материалов                                  │
│  ─────────────────────────────────────────────────────  │
│                                                          │
│  [Поиск...]                                             │
│                                                          │
│  Тип материалов:  [Все] [🌍 Глобальные] [🏢 Мои]  [Импорт] [Добавить] │
│                  └─────────────────────────┘     └──────────────────┘│
│                     Фильтр                        Кнопки (только для "Мои")
│                                                          │
│  ☑ Изображение  ☑ Поставщик                            │
│                                                          │
│  Всего материалов — 234                                 │
│                                                          │
│  [Таблица материалов...]                                │
└─────────────────────────────────────────────────────────┘
```

---

## 🔐 Логика отображения кнопок:

```javascript
// Кнопки видны только для тенантного справочника
{globalFilter === 'tenant' && (
  <Stack direction="row" spacing={1}>
    <Button size="small" startIcon={<IconUpload />}>
      Импорт
    </Button>
    <Button size="small" startIcon={<IconPlus />}>
      Добавить
    </Button>
  </Stack>
)}
```

### Таблица видимости:

| Фильтр         | Кнопки видны? | Причина                                    |
|----------------|---------------|--------------------------------------------|
| **Все**        | ❌ Нет        | Показывает и глобальные, и тенантные       |
| **Глобальные** | ❌ Нет        | Управление только для разработчиков        |
| **Мои**        | ✅ Да         | Пользователь может управлять своими материалами|

---

## 💡 Преимущества:

### 1. **Безопасность**
- Невозможно случайно создать/импортировать материал в глобальный справочник
- Явное разделение: "Мои материалы можно редактировать, глобальные - только смотреть"

### 2. **Понятность**
- Кнопки появляются только когда они актуальны
- Меньше визуального шума
- Логическая группировка: фильтр + действия рядом

### 3. **Консистентность**
- **Единый UX паттерн** с справочником работ
- Пользователь понимает логику с первого раза
- Предсказуемое поведение интерфейса

---

## 🧪 Как проверить:

1. Откройте http://localhost:3000/app/references/materials
2. **При загрузке** (фильтр "Все"): кнопок НЕТ ✅
3. **Переключите на "Глобальные"**: кнопок НЕТ ✅
4. **Переключите на "Мои"**: кнопки ПОЯВЛЯЮТСЯ ✅
5. Проверьте что кнопки работают:
   - "Импорт" → открывает диалог импорта
   - "Добавить" → открывает форму создания материала

---

## 📝 Технические детали:

### Измененный файл:
- `vite/app/references/materials/index.jsx`

### Измененные строки:
1. **Строки 345-367**: Упрощена шапка (удалены кнопки)
2. **Строки 390-440**: Добавлены условные кнопки рядом с фильтром

### Свойства кнопок:
```javascript
<Button 
  variant="outlined"    // Импорт - outlined
  size="small"          // Компактный размер
  startIcon={<IconUpload size={16} />} 
  onClick={handleOpenImport}
>
  Импорт
</Button>

<Button 
  variant="contained"   // Добавить - contained (акцент)
  color="primary" 
  size="small" 
  startIcon={<IconPlus size={16} />} 
  onClick={handleOpenCreate}
>
  Добавить
</Button>
```

---

## 🔄 Обратная совместимость:

✅ Все функции работают как прежде:
- Импорт работает
- Создание материала работает
- Логика `isGlobal={globalFilter === 'global'}` не изменилась

❌ Изменено только:
- Расположение кнопок
- Условие отображения кнопок
- Размер кнопок

---

## 📊 Результаты:

### Было:
- 2 кнопки всегда видны → **запутанно**
- Можно случайно импортировать в глобальный → **опасно**
- Кнопки в шапке → **далеко от фильтра**

### Стало:
- Кнопки только для "Мои" → **понятно**
- Невозможно редактировать глобальный → **безопасно**
- Кнопки рядом с фильтром → **логично**

---

## 🎯 Итог:

✅ **Управление тенантным справочником** стало интуитивным  
✅ **Глобальный справочник** защищен от случайных изменений  
✅ **UI стал чище** и менее загроможденным  
✅ **Логика импорта** осталась прежней (через фильтр)  
✅ **Единый UX паттерн** с справочником работ

---

## 📚 Аналогичные изменения:

Эти же изменения применены в:
- ✅ `app/references/works/index.jsx` (Справочник работ)
- ✅ `app/references/materials/index.jsx` (Справочник материалов)

**Теперь оба справочника работают одинаково!** 🎉

---

## 🔍 Как это работает:

### При выборе фильтра:

1. **"Все"** (`globalFilter === 'all'`)
   - Загружаются: глобальные + тенантные материалы
   - Кнопки: ❌ скрыты
   - Действия: только просмотр

2. **"Глобальные"** (`globalFilter === 'global'`)
   - Загружаются: только глобальные материалы
   - Кнопки: ❌ скрыты
   - Действия: только просмотр
   - API: `?isGlobal=true`

3. **"Мои"** (`globalFilter === 'tenant'`)
   - Загружаются: только тенантные материалы
   - Кнопки: ✅ видны ("Импорт", "Добавить")
   - Действия: полное управление (создание, редактирование, удаление, импорт)
   - API: `?isGlobal=false`
   - Импорт: `isGlobal={globalFilter === 'global'}` → `false`

---

## 🎨 Адаптивность:

```javascript
<Stack 
  direction="row" 
  spacing={2} 
  sx={{ 
    justifyContent: 'space-between',
    flexWrap: 'wrap',  // ← Переносится на мобильных
    gap: 2
  }}
>
  {/* Фильтр */}
  <Stack>...</Stack>
  
  {/* Кнопки (только для "Мои") */}
  {globalFilter === 'tenant' && (
    <Stack>...</Stack>
  )}
</Stack>
```

**Результат:**
- **Desktop**: Фильтр слева, кнопки справа (в одну линию)
- **Mobile**: Фильтр сверху, кнопки снизу (перенос строки)

---

## 🔐 Безопасность импорта:

### Backend проверка:
```javascript
// worksImportExportController.js & materialsImportExportController.js
const { isGlobal = false } = req.body;
const { isSuperAdmin } = req.user;

if (isGlobal && !isSuperAdmin) {
  return res.status(403).json({ 
    message: 'Только суперадмин может импортировать в глобальный справочник' 
  });
}
```

### Frontend логика:
```javascript
// index.jsx
isGlobal={globalFilter === 'global'}

// При выборе "Мои" → isGlobal = false
// При выборе "Глобальные" → кнопки скрыты (импорт невозможен)
```

**Двойная защита**: Frontend не показывает кнопки + Backend проверяет права ✅
