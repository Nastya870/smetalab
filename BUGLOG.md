# BUGLOG - –ñ—É—Ä–Ω–∞–ª –¥–µ—Ñ–µ–∫—Ç–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞ Smetalab v6

## –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ–∫—Ä—É–∂–µ–Ω–∏–∏

- **–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**: 2026-01-11
- **–í–µ—Ä—Å–∏—è –ø—Ä–æ–µ–∫—Ç–∞**: smetalab v6
- **Frontend URL**: http://localhost:3000
- **Backend URL**: http://localhost:3001/api
- **–¢–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫**: Antigravity AI

---

## –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–∞–≥–æ–≤

| –°—Ç–∞—Ç—É—Å | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ |
|--------|------------|
| Open | 0 |
| Fixed | 9 |
| Won't Fix | 0 |
| Can't Reproduce | 0 |
| **–í—Å–µ–≥–æ** | **9** |

---

## –°–ø–∏—Å–æ–∫ –¥–µ—Ñ–µ–∫—Ç–æ–≤

---

### BUG-008: Super Admin –≤–∏–¥–∏—Ç –ª–∏—à–Ω–∏–µ —Ä–æ–ª–∏ –≤ —Å–ø–∏—Å–∫–µ (regression)

| –ü–æ–ª–µ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|------|----------|
| **ID** | BUG-008 |
| **–°–µ—Ä—å—ë–∑–Ω–æ—Å—Ç—å** | minor |
| **–ú–æ–¥—É–ª—å/—ç–∫—Ä–∞–Ω** | server/controllers/rolesController.js, roles.api.test.js |
| **–°—Ç–∞—Ç—É—Å** | Fixed ‚úÖ |

**–®–∞–≥–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:**
1. –ó–∞–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è –∫–∞–∫ super_admin.
2. –í—ã–∑–≤–∞—Ç—å `GET /api/roles`.

**–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
–í–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –≤—Å–µ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Ä–æ–ª–∏, –≤–∫–ª—é—á–∞—è —à–∞–±–ª–æ–Ω—ã –¥–ª—è —Ç–µ–Ω–∞–Ω—Ç–æ–≤ (`manager`, `estimator`, `supplier`).

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
Super Admin –¥–æ–ª–∂–µ–Ω –≤–∏–¥–µ—Ç—å —Ç–æ–ª—å–∫–æ —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ä–æ–ª–∏ (`super_admin`, `admin`).

**–ü—Ä–∏—á–∏–Ω–∞:**
–û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–ª—é—á–∞–º –≤ SQL –∑–∞–ø—Ä–æ—Å–µ –¥–ª—è `isSuperAdmin`.

**–†–µ—à–µ–Ω–∏–µ:**
1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `getAllRoles` –≤ `rolesController.js` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω —Ñ–∏–ª—å—Ç—Ä `key IN ('super_admin', 'admin')`.
2. –ú–∞—Ä—à—Ä—É—Ç—ã `/api/roles` –∏ `/api/users/roles` –∫–æ–Ω—Å–æ–ª–∏–¥–∏—Ä–æ–≤–∞–Ω—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `rolesController.js`.
3. –£–¥–∞–ª–µ–Ω–∞ –¥—É–±–ª–∏—Ä—É—é—â–∞—è—Å—è –ª–æ–≥–∏–∫–∞ –∏–∑ `usersController.js`.

**–†–µ—Ç–µ—Å—Ç:**
–í—ã–ø–æ–ª–Ω–µ–Ω —Å–∫—Ä–∏–ø—Ç `scripts/verify_role_boundaries_final.js`. Super Admin –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ 2 —Ä–æ–ª–∏.

**–†–µ–≥—Ä–µ—Å—Å-–∑–æ–Ω–∞:**
–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã `/api/roles`, `/api/users/roles`, –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ä–æ–ª–µ–π –≤ UI.

---

### BUG-009: Rate Limiter –±–ª–æ–∫–∏—Ä—É–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ security —Ç–µ—Å—Ç–æ–≤ (429 Too Many Requests)

| –ü–æ–ª–µ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|------|----------|
| **ID** | BUG-009 |
| **–°–µ—Ä—å—ë–∑–Ω–æ—Å—Ç—å** | major |
| **–ú–æ–¥—É–ª—å/—ç–∫—Ä–∞–Ω** | server/middleware/rateLimiter.js, tests/security/* |
| **–°—Ç–∞—Ç—É—Å** | Fixed ‚úÖ |

**–®–∞–≥–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:**
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä security —Ç–µ—Å—Ç–æ–≤ `npm run test:security`.

**–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
–ú–Ω–æ–≥–∏–µ —Ç–µ—Å—Ç—ã –ø–∞–¥–∞—é—Ç —Å –æ—à–∏–±–∫–æ–π `429 Too Many Requests`, —Ç–∞–∫ –∫–∞–∫ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ª–∏–º–∏—Ç—ã (100 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É).

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
–¢–µ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã –ø—Ä–æ—Ö–æ–¥–∏—Ç—å —É—Å–ø–µ—à–Ω–æ, –ø—Ä–∏ —ç—Ç–æ–º rate limiter –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∞–∫—Ç–∏–≤–µ–Ω —Ç–∞–º, –≥–¥–µ –æ–Ω —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è (brute force protection).

**–ü—Ä–∏—á–∏–Ω–∞:**
–ñ–µ—Å—Ç–∫–æ –∑–∞–¥–∞–Ω–Ω—ã–µ –ª–∏–º–∏—Ç—ã –≤ –∫–æ–¥–µ –Ω–µ –ø–æ–∑–≤–æ–ª—è–ª–∏ –ø—Ä–æ–≤–æ–¥–∏—Ç—å –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ.

**–†–µ—à–µ–Ω–∏–µ:**
1. Rate limiters —Å–¥–µ–ª–∞–Ω—ã –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º–∏ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (`RATE_LIMIT_MAX`, `LOGIN_LIMIT_MAX` –∏ —Ç.–¥.).
2. –î–æ–±–∞–≤–ª–µ–Ω fallback –¥–ª—è `NaN` (parseInt) –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö ENV.
3. –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–ª–Ω–æ–≥–æ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è —á–µ—Ä–µ–∑ `DISABLE_RATE_LIMITER=true` –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤.
4. `heavyOperationsLimiter` –ø—Ä–∏–º–µ–Ω–µ–Ω –∫ —Ä–µ–∞–ª—å–Ω—ã–º —Ç—è–∂–µ–ª—ã–º —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º –≤ `server/index.js` (bulk, export, admin).

**–†–µ—Ç–µ—Å—Ç:**
`npm run test:security` –ø—Ä–æ—Ö–æ–¥–∏—Ç —É—Å–ø–µ—à–Ω–æ (241 —Ç–µ—Å—Ç).

**–†–µ–≥—Ä–µ—Å—Å-–∑–æ–Ω–∞:**
–í—Å–µ API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã, –æ—Å–æ–±–µ–Ω–Ω–æ –º–∞—Å—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (–∏–º–ø–æ—Ä—Ç/—ç–∫—Å–ø–æ—Ä—Ç).

---

### BUG-001: NullPointerException –ø—Ä–∏ –ª–æ–≥–∏–Ω–µ super_admin –±–µ–∑ tenant

| –ü–æ–ª–µ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|------|----------|
| **ID** | BUG-001 |
| **–°–µ—Ä—å—ë–∑–Ω–æ—Å—Ç—å** | critical |
| **–ú–æ–¥—É–ª—å/—ç–∫—Ä–∞–Ω** | server/controllers/authController.js, login() |
| **–°—Ç–∞—Ç—É—Å** | Fixed ‚úÖ |

**–®–∞–≥–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:**
1. –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è super_admin –±–µ–∑ –ø—Ä–∏–≤—è–∑–∫–∏ –∫ tenant
2. –ü–æ–ø—ã—Ç–∞—Ç—å—Å—è –∑–∞–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è —á–µ—Ä–µ–∑ /api/auth/login

**–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
TypeError: Cannot read properties of null (reading 'id')
```
–ù–∞ —Å—Ç—Ä–æ–∫–µ 666: `id: selectedTenant.id` ‚Äî selectedTenant –º–æ–∂–µ—Ç –±—ã—Ç—å null –¥–ª—è super_admin.

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
–õ–æ–≥–∏–Ω super_admin –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –≤–æ–∑–≤—Ä–∞—â–∞—è `tenant: null` –∏–ª–∏ –ø—É—Å—Ç–æ–π –æ–±—ä–µ–∫—Ç.

**–õ–æ–≥–∏/—Å–∫—Ä–∏–Ω/—Ç—Ä–µ–π—Å:**
–°—Ç—Ä–æ–∫–∏ 665-681 –≤ authController.js ‚Äî –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ selectedTenant –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ null.

**–ü–æ–≤—Ç–æ—Ä—è–µ–º–æ—Å—Ç—å:** 100% (–¥–ª—è super_admin –±–µ–∑ tenant)

**–ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º–∞—è –ø—Ä–∏—á–∏–Ω–∞:**
–ù–∞ —Å—Ç—Ä–æ–∫–∞—Ö 545-560 selectedTenant –º–æ–∂–µ—Ç –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ null –¥–ª—è super_admin –±–µ–∑ tenants, –Ω–æ –Ω–∞ —Å—Ç—Ä–æ–∫–∞—Ö 665-681 –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –±–µ–∑—É—Å–ª–æ–≤–Ω–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ —Å–≤–æ–π—Å—Ç–≤–∞–º selectedTenant –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏.

---

### BUG-002: Unit —Ç–µ—Å—Ç—ã –∑–∞–ø—É—Å–∫–∞—é—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î (globalSetup –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)

| –ü–æ–ª–µ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|------|----------|
| **ID** | BUG-002 |
| **–°–µ—Ä—å—ë–∑–Ω–æ—Å—Ç—å** | major |
| **–ú–æ–¥—É–ª—å/—ç–∫—Ä–∞–Ω** | vitest.config.mjs, tests/integration/setup.integration.js |
| **–°—Ç–∞—Ç—É—Å** | Fixed ‚úÖ |

**–®–∞–≥–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:**
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å `npm run test:unit`
2. –ù–∞–±–ª—é–¥–∞—Ç—å –≤—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª–∏

**–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
üîß SETUP: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
‚ùå –û—à–∏–±–∫–∞ –≤ 003_create_works_table.sql: function current_tenant_id() does not exist
‚ùå –û—à–∏–±–∫–∞ –≤ 003_setup_rls.sql: permission denied to create role
```
Unit —Ç–µ—Å—Ç—ã –ø—ã—Ç–∞—é—Ç—Å—è –∑–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î, –∫–æ—Ç–æ—Ä—ã–µ:
- –¢—Ä–µ–±—É—é—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Ä–µ–∞–ª—å–Ω–æ–π –ë–î
- –ü–∞–¥–∞—é—Ç —Å –æ—à–∏–±–∫–∞–º–∏ RLS —Ñ—É–Ω–∫—Ü–∏–π
- –ó–∞–Ω–∏–º–∞—é—Ç –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
Unit —Ç–µ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å –ë–ï–ó –ë–î, –∏—Å–ø–æ–ª—å–∑—É—è —Ç–æ–ª—å–∫–æ –º–æ–∫–∏. `globalSetup` —Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏ –¥–æ–ª–∂–µ–Ω –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è –¢–û–õ–¨–ö–û –∫ integration —Ç–µ—Å—Ç–∞–º.

**–õ–æ–≥–∏/—Å–∫—Ä–∏–Ω/—Ç—Ä–µ–π—Å:**
`vitest.config.mjs` —Å—Ç—Ä–æ–∫–∞ 14: `globalSetup: ['./tests/integration/setup.integration.js']` ‚Äî –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫–æ –≤—Å–µ–º —Ç–µ—Å—Ç–∞–º –≤–º–µ—Å—Ç–æ —Ç–æ–ª—å–∫–æ integration.

**–ü–æ–≤—Ç–æ—Ä—è–µ–º–æ—Å—Ç—å:** 100%

**–ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º–∞—è –ø—Ä–∏—á–∏–Ω–∞:**
–í `vitest.config.mjs` –ø–∞—Ä–∞–º–µ—Ç—Ä `globalSetup` –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –≥–ª–æ–±–∞–ª—å–Ω–æ –∫–æ –≤—Å–µ–º —Ç–µ—Å—Ç–∞–º. –ù—É–∂–Ω–æ –ª–∏–±–æ —É–±—Ä–∞—Ç—å –µ–≥–æ, –ª–∏–±–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è unit –∏ integration —Ç–µ—Å—Ç–æ–≤.

**–ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–æ–µ —Ä–µ—à–µ–Ω–∏–µ:**
1. –°–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥–∏: `vitest.unit.config.mjs` –∏ `vitest.integration.config.mjs`
2. –õ–∏–±–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å workspace configuration –≤ vitest
3. –õ–∏–±–æ —É–±—Ä–∞—Ç—å globalSetup –∏ –≤—ã–∑—ã–≤–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—Ä—É—á–Ω—É—é –ø–µ—Ä–µ–¥ integration —Ç–µ—Å—Ç–∞–º–∏

---

### BUG-003: –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ unit —Ç–µ—Å—Ç—ã –ø–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

| –ü–æ–ª–µ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|------|----------|
| **ID** | BUG-003 |
| **–°–µ—Ä—å—ë–∑–Ω–æ—Å—Ç—å** | major |
| **–ú–æ–¥—É–ª—å/—ç–∫—Ä–∞–Ω** | tests/unit/estimates/components/*.test.jsx |
| **–°—Ç–∞—Ç—É—Å** | Fixed ‚úÖ |

**–®–∞–≥–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:**
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å `npm run test:unit`
2. –ù–∞–±–ª—é–¥–∞—Ç—å 14 —É–ø–∞–≤—à–∏—Ö —Ç–µ—Å—Ç–æ–≤

**–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
Test Files: 2 failed | 14 passed (16)
Tests: 14 failed | 252 passed (266)
```
–¢–µ—Å—Ç—ã –∏—â—É—Ç —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ —Ç–µ–∫—Å—Ç—ã –∏ —ç–ª–µ–º–µ–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã—Ö –±–æ–ª—å—à–µ –Ω–µ—Ç –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö:
- `MaterialsDialog.test.jsx`: –æ–∂–∏–¥–∞–µ—Ç `'–ó–∞–≥—Ä—É–∑–∫–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤...'`, –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç `'–°–ø–∏—Å–æ–∫ –ø—É—Å—Ç'`
- `MaterialsDialog.test.jsx`: –æ–∂–∏–¥–∞–µ—Ç –ø–æ–¥—Å–∫–∞–∑–∫—É `'–ü–æ–∏—Å–∫ –≤ –±–∞–∑–µ 47,000 –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤'`, –∏–∑–º–µ–Ω–µ–Ω–æ –Ω–∞ `'üîç –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–æ–±–µ–ª...'`
- Virtuoso –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è –Ω–µ —Ä–µ–Ω–¥–µ—Ä–∏—Ç –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å—Ä–∞–∑—É

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
–í—Å–µ unit —Ç–µ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã –ø—Ä–æ—Ö–æ–¥–∏—Ç—å.

**–ü–æ–≤—Ç–æ—Ä—è–µ–º–æ—Å—Ç—å:** 100%

**–ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º–∞—è –ø—Ä–∏—á–∏–Ω–∞:**
–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –±—ã–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã/–ø–µ—Ä–µ–ø–∏—Å–∞–Ω—ã, –Ω–æ unit —Ç–µ—Å—Ç—ã –Ω–µ –±—ã–ª–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã.

---

### BUG-004: Integration —Ç–µ—Å—Ç—ã –ø–∞–¥–∞—é—Ç –∏–∑-–∑–∞ jsdom environment –∏ OpenAI SDK

| –ü–æ–ª–µ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|------|----------|
| **ID** | BUG-004 |
| **–°–µ—Ä—å—ë–∑–Ω–æ—Å—Ç—å** | major |
| **–ú–æ–¥—É–ª—å/—ç–∫—Ä–∞–Ω** | vitest.config.mjs, tests/integration/*.test.js |
| **–°—Ç–∞—Ç—É—Å** | Fixed ‚úÖ |

**–®–∞–≥–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:**
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å `npm run test:integration`
2. –ù–∞–±–ª—é–¥–∞—Ç—å –æ—à–∏–±–∫—É

**–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
Error: It looks like you're running in a browser-like environment.
This is disabled by default, as it risks exposing your secret API credentials to attackers.
new OpenAI({ apiKey, dangerouslyAllowBrowser: true });
```
–í—Å–µ 10 integration test files –ø–∞–¥–∞—é—Ç —Å—Ä–∞–∑—É –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ.

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
Integration —Ç–µ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `environment: 'node'`, –∞ –Ω–µ `jsdom`.

**–õ–æ–≥–∏/—Å–∫—Ä–∏–Ω/—Ç—Ä–µ–π—Å:**
- `server/services/semanticSearchService.js:8` ‚Äî OpenAI SDK –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è
- vitest.config.mjs –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `environment: 'jsdom'` –≥–ª–æ–±–∞–ª—å–Ω–æ

**–ü–æ–≤—Ç–æ—Ä—è–µ–º–æ—Å—Ç—å:** 100%

**–ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º–∞—è –ø—Ä–∏—á–∏–Ω–∞:**
Vitest –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —É–∫–∞–∑—ã–≤–∞–µ—Ç `environment: 'jsdom'` –¥–ª—è –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤. Integration —Ç–µ—Å—Ç—ã —Ç–µ—Å—Ç–∏—Ä—É—é—Ç Node.js API –∏ –ù–ï –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å jsdom.

**–ü—Ä–µ–¥–ª–∞–≥–∞–µ–º–æ–µ —Ä–µ—à–µ–Ω–∏–µ:**
1. –°–æ–∑–¥–∞—Ç—å vitest workspace configuration
2. –õ–∏–±–æ —É–∫–∞–∑–∞—Ç—å `environment: 'node'` per-file —á–µ—Ä–µ–∑ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π `// @vitest-environment node`

---

### BUG-005: –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è API responses –≤ integration —Ç–µ—Å—Ç–∞—Ö

| –ü–æ–ª–µ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|------|----------|
| **ID** | BUG-005 |
| **–°–µ—Ä—å—ë–∑–Ω–æ—Å—Ç—å** | major |
| **–ú–æ–¥—É–ª—å/—ç–∫—Ä–∞–Ω** | projects.api, users.api, API controllers |
| **–°—Ç–∞—Ç—É—Å** | Fixed ‚úÖ |

**–®–∞–≥–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:**
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å `npm run test:integration`
2. –ù–∞–±–ª—é–¥–∞—Ç—å 4 —É–ø–∞–≤—à–∏—Ö —Ç–µ—Å—Ç–∞

**–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
Tests: 4 failed | 128 passed | 8 skipped (140)
```
–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è:
1. `PUT /api/projects/:id` —Å `status: 'invalid_status'` ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 500 –≤–º–µ—Å—Ç–æ 400
2. `GET /api/projects/dashboard-summary` ‚Üí `chartDataMonth` undefined
3. `POST /api/users` –¥–ª—è —Å–ª–∞–±–æ–≥–æ –ø–∞—Ä–æ–ª—è ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 409 –≤–º–µ—Å—Ç–æ 400

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
API –¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ HTTP –∫–æ–¥—ã –∏ –¥–∞–Ω–Ω—ã–µ —Å–æ–≥–ª–∞—Å–Ω–æ —Ç–µ—Å—Ç–∞–º.

**–ü–æ–≤—Ç–æ—Ä—è–µ–º–æ—Å—Ç—å:** 100%

**–ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º–∞—è –ø—Ä–∏—á–∏–Ω–∞:**
1. –í–æ–∑–º–æ–∂–Ω–æ API –Ω–µ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç status –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º ‚Üí 500 –∏–∑ PostgreSQL
2. Dashboard API –º–æ–∂–µ—Ç –±—ã–ª –∏–∑–º–µ–Ω–µ–Ω –∏ –±–æ–ª—å—à–µ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `chartDataMonth`
3. –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–æ–ª—è –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥—É–±–ª–∏–∫–∞—Ç–∞ email ‚Üí 409 –≤–º–µ—Å—Ç–æ 400

**–¢—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é
- –°–≤–µ—Ä–∏—Ç—å —Ç–µ—Å—Ç—ã —Å –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π API

---

### BUG-006: –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Å—Ç—Ä–µ–π–Ω—Ç—ã –≤ –ë–î, –±–ª–æ–∫–∏—Ä—É—é—â–∏–µ —Å–∏–¥–∏–Ω–≥

| –ü–æ–ª–µ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|------|----------|
| **ID** | BUG-006 |
| **–°–µ—Ä—å—ë–∑–Ω–æ—Å—Ç—å** | blocker |
| **–ú–æ–¥—É–ª—å/—ç–∫—Ä–∞–Ω** | Database Schema (roles, permissions) |
| **–°—Ç–∞—Ç—É—Å** | Fixed ‚úÖ |

**–®–∞–≥–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:**
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å `npm run db:migrate` –∏–ª–∏ —Å–∫—Ä–∏–ø—Ç —Å–∏–¥–∏–Ω–≥–∞ `node scripts/runSeedsOnly.js`.
2. –ù–∞–±–ª—é–¥–∞—Ç—å –æ—à–∏–±–∫—É SQL.

**–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
‚ùå –û—à–∏–±–∫–∞ –≤ —Ñ–∞–π–ª–µ 002_seed_roles_permissions.sql:
there is no unique or exclusion constraint matching the ON CONFLICT specification
```
–í —Ç–∞–±–ª–∏—Ü–∞—Ö `roles`, `permissions`, `role_permissions` –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç `UNIQUE` –∏–Ω–¥–µ–∫—Å—ã, —á—Ç–æ –¥–µ–ª–∞–µ—Ç –Ω–µ–≤–æ–∑–º–æ–∂–Ω—ã–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `ON CONFLICT DO NOTHING`. –≠—Ç–æ –ø—Ä–∏–≤–µ–ª–æ –∫ —Å–æ–∑–¥–∞–Ω–∏—é —Ç—ã—Å—è—á –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ —Ä–æ–ª–µ–π.

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
–¢–∞–±–ª–∏—Ü—ã –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Å—Ç—Ä–µ–π–Ω—Ç—ã:
- `roles(key)`
- `permissions(key)`
- `permissions(resource, action)`
- `role_permissions(role_id, permission_id)`
–°–∏–¥–∏–Ω–≥ –¥–æ–ª–∂–µ–Ω –ø—Ä–æ—Ö–æ–¥–∏—Ç—å —É—Å–ø–µ—à–Ω–æ –∏ –±—ã—Ç—å –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–º.

**–†–µ—à–µ–Ω–∏–µ:**
1. –°–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è `060_fix_roles_permissions_constraints.sql`, —É–¥–∞–ª—è—é—â–∞—è –¥—É–±–ª–∏–∫–∞—Ç—ã –∏ –¥–æ–±–∞–≤–ª—è—é—â–∞—è UNIQUE –∫–æ–Ω—Å—Ç—Ä–µ–π–Ω—Ç—ã.
2. –°–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è `061_fix_roles_unique_constraint.sql` –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ª–æ–≥–∏–∫–∏ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ —Ä–æ–ª–µ–π (tenant_id IS NULL).
3. –ü—Ä–∏–º–µ–Ω–µ–Ω —Å–∫—Ä–∏–ø—Ç `final_restore_roles.js` –¥–ª—è –ø–æ–ª–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è 13,000+ —Ä–æ–ª–µ–π –¥–ª—è –≤—Å–µ—Ö 3300+ —Ç–µ–Ω–∞–Ω—Ç–æ–≤ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∫–æ–Ω—Å—Ç—Ä–µ–π–Ω—Ç–∞–º–∏.
4. –°–∏–¥–∏–Ω–≥ —Ç–µ–ø–µ—Ä—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–µ–Ω –∏ –∑–∞—â–∏—â–µ–Ω —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ –∏–Ω–¥–µ–∫—Å–∞–º–∏.

---

### BUG-007: PERMISSION_DENIED –¥–ª—è –Ω–æ–≤–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —Ç–µ–Ω–∞–Ω—Ç–∞

| –ü–æ–ª–µ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|------|----------|
| **ID** | BUG-007 |
| **–°–µ—Ä—å—ë–∑–Ω–æ—Å—Ç—å** | blocker |
| **–ú–æ–¥—É–ª—å/—ç–∫—Ä–∞–Ω** | API / Projects / Auth |
| **–°—Ç–∞—Ç—É—Å** | Fixed ‚úÖ |

**–®–∞–≥–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:**
1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—É—é –∫–æ–º–ø–∞–Ω–∏—é –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (Admin) —á–µ—Ä–µ–∑ `POST /api/auth/register`.
2. –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω.
3. –ü–æ–ø—ã—Ç–∞—Ç—å—Å—è —Å–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç `POST /api/projects` —Å —ç—Ç–∏–º —Ç–æ–∫–µ–Ω–æ–º.

**–§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```json
{
  "success": false,
  "message": "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏—è",
  "error": "PERMISSION_DENIED",
  "required": "projects.create"
}
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –∫–æ–º–ø–∞–Ω–∏–∏ –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –ø—Ä–∞–≤–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç—ã (permission `projects.create`).

**–ü—Ä–∏—á–∏–Ω–∞:**
1. –ì–ª–æ–±–∞–ª—å–Ω—ã–π —à–∞–±–ª–æ–Ω —Ä–æ–ª–∏ `admin` –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª –∏–ª–∏ –±—ã–ª –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω.
2. –í Test Mode —Ç–æ–∫–µ–Ω—ã –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª–∏—Å—å —Å –ø—É—Å—Ç—ã–º —Å–ø–∏—Å–∫–æ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π.

**–†–µ—à–µ–Ω–∏–µ:**
1. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≥–ª–æ–±–∞–ª—å–Ω—ã–π —à–∞–±–ª–æ–Ω —Ä–æ–ª–∏ `admin` –∏ –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è.
2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω `authController.js` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–∞–≤ –∏–∑ –ë–î –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π —Ç–æ–∫–µ–Ω–∞ –≤ Test Mode.
3. –î–æ–±–∞–≤–ª–µ–Ω –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç `tests/integration/verify_permissions_boundary.test.js`, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—â–∏–π:
    - –£—Å–ø–µ—à–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º.
    - –û—Ç–∫–∞–∑ –≤ –¥–æ—Å—Ç—É–ø–µ (403) –¥–ª—è —Ä–æ–ª–∏ `viewer`.
    - –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π –≤ JWT –ø—Ä–∏ —Å–º–µ–Ω–µ —Ä–æ–ª–∏.
4. –í—Å–µ —Ç–µ—Å—Ç—ã Phase 1 (—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è -> –ø—Ä–æ–µ–∫—Ç -> —Å–º–µ—Ç–∞) –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ.

---
