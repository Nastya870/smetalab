# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é Pinecone Search

## –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ .env
```bash
TEST_PASSWORD=—Ç–≤–æ–π_–ø–∞—Ä–æ–ª—å_–æ—Ç_kiy02@yandex.ru
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ backend
```bash
curl https://smetalab-backend.onrender.com/health
```

## –¢–µ—Å—Ç–æ–≤—ã–µ —Å–∫—Ä–∏–ø—Ç—ã

### –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
```bash
node scripts/quick-stats.mjs
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
‚úÖ –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ò–ù–î–ï–ö–°–ê:
üìà –í—Å–µ–≥–æ –≤–µ–∫—Ç–æ—Ä–æ–≤: 50347
üìè –†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å: 1536
üì¶ Namespaces: { "": { "vectorCount": 50347 } }
```

### –ü–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Search API
```bash
node scripts/test-search-api.mjs
```

**–ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è:**
1. ‚úÖ –õ–æ–≥–∏–Ω –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ JWT —Ç–æ–∫–µ–Ω–∞
2. ‚úÖ –ü–æ–∏—Å–∫ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ (—Ç—Ä—É–±–∞, —Ü–µ–º–µ–Ω—Ç, –∫–∏—Ä–ø–∏—á, –∞—Ä–º–∞—Ç—É—Ä–∞)
3. ‚úÖ –ü–æ–∏—Å–∫ —Ä–∞–±–æ—Ç (–º–æ–Ω—Ç–∞–∂, –±–µ—Ç–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, –æ–∫—Ä–∞—Å–∫–∞)
4. ‚úÖ –§–∏–ª—å—Ç—Ä—ã –ø–æ —Ç–∏–ø—É (material, work, all)
5. ‚úÖ –ö–∞—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (score > 0.7)

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
‚úîÔ∏è  –£—Å–ø–µ—à–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤: 8/8 (100%)
üéâ –û–¢–õ–ò–ß–ù–û! –ü–æ–∏—Å–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–µ–≤–æ—Å—Ö–æ–¥–Ω–æ
```

## –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ curl

### 1. –ü–æ–ª—É—á–∏—Ç—å JWT —Ç–æ–∫–µ–Ω
```bash
curl -X POST https://smetalab-backend.onrender.com/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "kiy02@yandex.ru",
    "password": "—Ç–≤–æ–π_–ø–∞—Ä–æ–ª—å"
  }'
```

–û—Ç–≤–µ—Ç:
```json
{
  "success": true,
  "tokens": {
    "accessToken": "eyJhbGc...",
    "refreshToken": "eyJhbGc..."
  }
}
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏–Ω–¥–µ–∫—Å–∞
```bash
curl https://smetalab-backend.onrender.com/api/search/pinecone/stats \
  -H "Authorization: Bearer <—Ç–≤–æ–π_—Ç–æ–∫–µ–Ω>"
```

### 3. –í—ã–ø–æ–ª–Ω–∏—Ç—å –ø–æ–∏—Å–∫
```bash
curl -X POST https://smetalab-backend.onrender.com/api/search/pinecone \
  -H "Authorization: Bearer <—Ç–≤–æ–π_—Ç–æ–∫–µ–Ω>" \
  -H "Content-Type: application/json" \
  -d '{
    "query": "—Ç—Ä—É–±–∞ —Å—Ç–∞–ª—å–Ω–∞—è",
    "type": "material",
    "limit": 5
  }'
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞:**
- `query` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π) - –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
- `type` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - `material`, `work`, –∏–ª–∏ `all` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: all)
- `scope` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - `global`, `tenant`, –∏–ª–∏ `all` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: all)
- `limit` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 10, –º–∞–∫—Å: 100)

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:**
```json
{
  "success": true,
  "query": "—Ç—Ä—É–±–∞ —Å—Ç–∞–ª—å–Ω–∞—è",
  "count": 5,
  "results": [
    {
      "id": "global-material-12345",
      "score": 0.923,
      "type": "material",
      "dbId": "12345",
      "text": "–¢—Ä—É–±–∞ —Å—Ç–∞–ª—å–Ω–∞—è 100—Ö100—Ö4 –º–º. –ú–µ—Ç–∞–ª–ª–æ–ø—Ä–æ–∫–∞—Ç. –°—Ç–∞–ª—å–Ω–∞—è —Ç—Ä—É–±–∞ –ø—Ä–æ—Ñ–∏–ª—å–Ω–∞—è...",
      "metadata": {
        "category": "–ú–µ—Ç–∞–ª–ª–æ–ø—Ä–æ–∫–∞—Ç",
        "supplier": "–ú–µ—Ç–∞–ª–ª–°–Ω–∞–±",
        "unit": "–º",
        "isGlobal": true
      }
    }
  ]
}
```

## –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### Score (—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å)
- **> 0.8** - –û—Ç–ª–∏—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
- **0.7-0.8** - –•–æ—Ä–æ—à–µ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
- **0.5-0.7** - –°—Ä–µ–¥–Ω–µ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
- **< 0.5** - –°–ª–∞–±–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ

### –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- –î–æ–ª–∂–Ω–æ –±—ã—Ç—å > 0 –¥–ª—è –ª—é–±–æ–≥–æ —Ä–∞–∑—É–º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
- –¢–æ–ø —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å score > 0.7

## Troubleshooting

### Backend –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Render
https://dashboard.render.com/web/srv-d52grhfpm1nc73ent21g/logs

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å health endpoint
curl https://smetalab-backend.onrender.com/health
```

### 403 Forbidden –ø—Ä–∏ –ø–æ–∏—Å–∫–µ
- –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ —Ç–æ–∫–µ–Ω –Ω–µ –∏—Å—Ç—ë–∫ (–≤—Ä–µ–º—è –∂–∏–∑–Ω–∏: 15 –º–∏–Ω—É—Ç)
- –ü–æ–ª—É—á–∏ –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω —á–µ—Ä–µ–∑ /api/auth/login

### –ù–∏–∑–∫–∞—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ –¥–∞–Ω–Ω—ã—Ö –≤ `vector_index_state`:
   ```sql
   SELECT id, text FROM vector_index_state LIMIT 10;
   ```

2. –ü–µ—Ä–µ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏–Ω–¥–µ–∫—Å:
   ```bash
   node scripts/batch-sync-pinecone.mjs --offset 0
   ```

### –ü—É—Å—Ç—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–µ–∫—Ç–æ—Ä–æ–≤:
   ```bash
   node scripts/quick-stats.mjs
   ```

2. –ï—Å–ª–∏ –≤–µ–∫—Ç–æ—Ä–æ–≤ –Ω–µ—Ç - –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é:
   ```bash
   node scripts/batch-sync-pinecone.mjs
   ```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ Production

### Pinecone Console
https://app.pinecone.io/organizations/-OHv0NGYh2sL/projects/d52grhf:smetalab-search/indexes/smetalab-search

**–ß—Ç–æ —Å–º–æ—Ç—Ä–µ—Ç—å:**
- Vector count (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å ~50K)
- Requests per second
- Query latency (p50, p99)
- Error rate

### Render Dashboard
https://dashboard.render.com/web/srv-d52grhfpm1nc73ent21g

**–ß—Ç–æ —Å–º–æ—Ç—Ä–µ—Ç—å:**
- CPU usage (–Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å > 80%)
- Memory usage
- Response time /api/search/pinecone
- Error logs

## –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞

‚úÖ **–°–∏—Å—Ç–µ–º–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è –≥–æ—Ç–æ–≤–æ–π –µ—Å–ª–∏:**
1. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 50K+ –≤–µ–∫—Ç–æ—Ä–æ–≤
2. –¢–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —Å —É—Å–ø–µ—Ö–æ–º > 90%
3. –°—Ä–µ–¥–Ω–∏–π score —Ç–æ–ø —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ > 0.75
4. –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ API < 2 —Å–µ–∫—É–Ω–¥
5. –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ production –ª–æ–≥–∞—Ö

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤

1. ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é (cron job –Ω–∞ Render)
2. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Prometheus/Grafana)
3. ‚úÖ –°–æ–∑–¥–∞—Ç—å UI –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
4. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (Redis)
5. ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã –Ω–∞ –æ—à–∏–±–∫–∏ –ø–æ–∏—Å–∫–∞

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** –î–µ–∫–∞–±—Ä—å 2025  
**–ê–≤—Ç–æ—Ä:** AI Agent
