# 💾 Сохранение состояния фильтров в localStorage

## 🎯 Проблема:
При обновлении страницы фильтр типа ("Все", "Глобальные", "Мои") сбрасывался на "Все", даже если пользователь выбрал другой фильтр.

## ✅ Решение:
Добавлено сохранение выбранного фильтра в `localStorage` браузера.

---

## 📝 Технические детали:

### Справочник работ (`app/references/works/index.jsx`)

#### 1. Инициализация state с восстановлением из localStorage:
```javascript
const [globalFilter, setGlobalFilter] = useState(() => {
  return localStorage.getItem('worksGlobalFilter') || 'all';
});
```

#### 2. Сохранение при изменении:
```javascript
useEffect(() => {
  localStorage.setItem('worksGlobalFilter', globalFilter);
}, [globalFilter]);
```

**Ключ localStorage:** `worksGlobalFilter`

---

### Справочник материалов (`app/references/materials/index.jsx`)

#### 1. Инициализация state с восстановлением из localStorage:
```javascript
const [globalFilter, setGlobalFilter] = useState(() => {
  return localStorage.getItem('materialsGlobalFilter') || 'all';
});
```

#### 2. Сохранение при изменении:
```javascript
useEffect(() => {
  localStorage.setItem('materialsGlobalFilter', globalFilter);
}, [globalFilter]);
```

**Ключ localStorage:** `materialsGlobalFilter`

---

## 🎨 Поведение:

### До изменений:
```
1. Пользователь выбирает "Мои" → видит тенантные данные
2. Пользователь обновляет страницу (F5)
3. ❌ Фильтр сбрасывается на "Все" → видит все данные
```

### После изменений:
```
1. Пользователь выбирает "Мои" → видит тенантные данные
2. Фильтр сохраняется в localStorage
3. Пользователь обновляет страницу (F5)
4. ✅ Фильтр остается "Мои" → видит тенантные данные
```

---

## 🔍 Проверка в DevTools:

Откройте Console (F12) и выполните:

```javascript
// Проверка сохраненных фильтров
localStorage.getItem('worksGlobalFilter');      // "all" | "global" | "tenant"
localStorage.getItem('materialsGlobalFilter');  // "all" | "global" | "tenant"

// Ручная очистка (для тестирования)
localStorage.removeItem('worksGlobalFilter');
localStorage.removeItem('materialsGlobalFilter');
```

---

## 💡 Преимущества:

### 1. **Сохранение контекста**
- Пользователь не теряет выбранный фильтр при обновлении
- Фильтр сохраняется между сеансами работы
- Удобнее работать с одним типом данных (например, только "Мои")

### 2. **Персонализация**
- Каждый пользователь может установить свой "любимый" фильтр
- Фильтр сохраняется отдельно для работ и материалов
- Настройки хранятся локально в браузере

### 3. **UX улучшение**
- Меньше кликов для возврата к нужному фильтру
- Предсказуемое поведение интерфейса
- Соответствует ожиданиям пользователей

---

## 🧪 Сценарии использования:

### Сценарий 1: Работа с тенантными данными
```
1. Пользователь открывает "Справочник работ"
2. Выбирает фильтр "Мои"
3. Работает с тенантными работами
4. Обновляет страницу
5. ✅ Остается на фильтре "Мои"
6. Переходит в "Справочник материалов"
7. Выбирает фильтр "Мои"
8. Работает с тенантными материалами
9. Обновляет страницу
10. ✅ Остается на фильтре "Мои"
```

### Сценарий 2: Просмотр глобальных данных
```
1. Администратор открывает "Справочник работ"
2. Выбирает фильтр "Глобальные"
3. Просматривает глобальные работы
4. Закрывает вкладку
5. Открывает вкладку снова
6. ✅ Автоматически открывается фильтр "Глобальные"
```

---

## 🔄 Жизненный цикл:

```
┌─────────────────────────────────────────────┐
│ 1. Монтирование компонента                 │
│    useState(() => localStorage.get(...))   │
│    → Восстанавливаем сохраненный фильтр    │
└────────────────┬────────────────────────────┘
                 │
                 ↓
┌─────────────────────────────────────────────┐
│ 2. Пользователь меняет фильтр              │
│    setGlobalFilter('tenant')               │
└────────────────┬────────────────────────────┘
                 │
                 ↓
┌─────────────────────────────────────────────┐
│ 3. useEffect срабатывает                   │
│    localStorage.setItem(key, value)        │
│    → Сохраняем в браузере                  │
└────────────────┬────────────────────────────┘
                 │
                 ↓
┌─────────────────────────────────────────────┐
│ 4. Обновление страницы (F5)                │
│    → Возврат к шагу 1                      │
│    → Фильтр восстанавливается ✅           │
└─────────────────────────────────────────────┘
```

---

## ⚙️ Настройки localStorage:

### Ключи:
- `worksGlobalFilter` - фильтр для справочника работ
- `materialsGlobalFilter` - фильтр для справочника материалов

### Возможные значения:
- `"all"` - Все (по умолчанию)
- `"global"` - Глобальные
- `"tenant"` - Мои

### Время жизни:
- **Постоянное** - сохраняется даже после закрытия браузера
- Удаляется только при:
  - Очистке истории браузера
  - Ручном удалении через DevTools
  - Программном удалении через `localStorage.removeItem()`

---

## 🎯 Итог:

✅ **Фильтры теперь "запоминают" выбор пользователя**  
✅ **Независимое сохранение для работ и материалов**  
✅ **Улучшенный UX без дополнительных кликов**  
✅ **Персонализированный опыт для каждого пользователя**

---

## 📚 Измененные файлы:

```
vite/app/references/works/index.jsx       - Добавлено сохранение фильтра
vite/app/references/materials/index.jsx   - Добавлено сохранение фильтра
```

---

**Дата:** 17 ноября 2025  
**Автор:** AI Assistant  
**Версия:** 1.0
