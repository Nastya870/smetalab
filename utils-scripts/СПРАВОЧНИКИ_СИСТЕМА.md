# üìö –°–∏—Å—Ç–µ–º–∞ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–≤: –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –∏ –¢–µ–Ω–∞–Ω—Ç–Ω—ã–µ

## üéØ –ö–æ–Ω—Ü–µ–ø—Ü–∏—è

–í —Å–∏—Å—Ç–µ–º–µ SMETA —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ **–¥–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–≤**:

### 1Ô∏è‚É£ **–ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏** (is_global = TRUE)
- üåç –î–æ—Å—Ç—É–ø–Ω—ã **–≤—Å–µ–º –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º** (—Ç–µ–Ω–∞–Ω—Ç–∞–º)
- üìã –ë–∞–∑–æ–≤—ã–π –Ω–∞–±–æ—Ä —Ä–∞–±–æ—Ç/–º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
- üîí –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –º–æ–≥—É—Ç **—Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã**
- ‚ôæÔ∏è `tenant_id = NULL` (–Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏)
- üëÅÔ∏è –í–∏–¥–Ω—ã –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —Å–∏—Å—Ç–µ–º—ã

### 2Ô∏è‚É£ **–¢–µ–Ω–∞–Ω—Ç–Ω—ã–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏** (is_global = FALSE)  
- üè¢ –ü—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç **–∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏**
- üîê –í–∏–¥–Ω—ã **—Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —Å–≤–æ–µ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏**
- ‚úèÔ∏è –ú–æ–≥—É—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å **–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏**
- üîó `tenant_id = UUID` (–ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ tenant)
- üìù –°–æ–∑–¥–∞—é—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –¥–ª—è —Å–≤–æ–∏—Ö –Ω—É–∂–¥

---

## üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ë–î

### –¢–∞–±–ª–∏—Ü–∞ `works` (–†–∞–±–æ—Ç—ã):

```sql
–°—Ç—Ä—É–∫—Ç—É—Ä–∞:
  id                   integer                   NOT NULL (PK)
  code                 varchar                   NOT NULL (UNIQUE)
  name                 varchar                   NOT NULL
  unit                 varchar                   NOT NULL
  base_price           numeric                   NOT NULL DEFAULT 0.00
  tenant_id            uuid                      NULL     (FK ‚Üí tenants)
  created_by           uuid                      NULL     (FK ‚Üí users)
  created_at           timestamp                 NULL     DEFAULT NOW()
  updated_at           timestamp                 NULL     DEFAULT NOW()
  is_global            boolean                   NULL     DEFAULT false
  phase                varchar                   NULL
  section              varchar                   NULL
  subsection           varchar                   NULL
```

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:**
- üåç **–ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ä–∞–±–æ—Ç—ã:** 3371 –∑–∞–ø–∏—Å–µ–π
- üè¢ **–¢–µ–Ω–∞–Ω—Ç–Ω—ã–µ —Ä–∞–±–æ—Ç—ã:** 0 –∑–∞–ø–∏—Å–µ–π (–≤ —Ç–µ–∫—É—â–µ–π –ë–î)

**–ò–µ—Ä–∞—Ä—Ö–∏—è —Ä–∞–±–æ—Ç:**
- üìÇ **–§–∞–∑–∞** (phase) ‚Üí üìÅ **–†–∞–∑–¥–µ–ª** (section) ‚Üí üìÑ **–ü–æ–¥—Ä–∞–∑–¥–µ–ª** (subsection)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–º–µ—Å—Ç–æ –ø–æ–ª—è `category` (–∫–æ—Ç–æ—Ä–æ–µ –±—ã–ª–æ —É–¥–∞–ª–µ–Ω–æ –∏–∑ UI)

---

## üîê Row Level Security (RLS)

### –ü–æ–ª–∏—Ç–∏–∫–∞ SELECT (–ø—Ä–æ—Å–º–æ—Ç—Ä):
```sql
-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç:
-- 1. –í—Å–µ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Ä–∞–±–æ—Ç—ã (is_global = TRUE)
-- 2. –°–≤–æ–∏ —Ç–µ–Ω–∞–Ω—Ç–Ω—ã–µ —Ä–∞–±–æ—Ç—ã (tenant_id = current_tenant_id())
-- 3. –ê–¥–º–∏–Ω—ã –≤–∏–¥—è—Ç –≤—Å—ë (is_super_admin())

CREATE POLICY works_tenant_isolation ON works
  FOR SELECT
  USING (
    is_global = TRUE OR 
    tenant_id IS NULL OR 
    tenant_id = current_tenant_id() OR 
    is_super_admin()
  );
```

### –ü–æ–ª–∏—Ç–∏–∫–∞ INSERT (—Å–æ–∑–¥–∞–Ω–∏–µ):
```sql
-- –û–±—ã—á–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–æ–∑–¥–∞—é—Ç —Ç–æ–ª—å–∫–æ —Ç–µ–Ω–∞–Ω—Ç–Ω—ã–µ
-- –ê–¥–º–∏–Ω—ã –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–µ

CREATE POLICY works_insert_policy ON works
  FOR INSERT
  WITH CHECK (
    (is_global = FALSE AND tenant_id = current_tenant_id()) OR
    (is_global = TRUE AND is_super_admin())
  );
```

### –ü–æ–ª–∏—Ç–∏–∫–∞ UPDATE/DELETE:
```sql
-- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å/—É–¥–∞–ª—è—Ç—å:
-- - –°–≤–æ–∏ —Ç–µ–Ω–∞–Ω—Ç–Ω—ã–µ —Ä–∞–±–æ—Ç—ã –º–æ–≥—É—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
-- - –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ä–∞–±–æ—Ç—ã –º–æ–≥—É—Ç —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã
```

---

## üíª Frontend - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ç–∏–ø—É

### UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç (ToggleButtonGroup):

```jsx
<ToggleButtonGroup
  value={globalFilter}
  exclusive
  onChange={(e, newValue) => newValue && setGlobalFilter(newValue)}
>
  <ToggleButton value="all">
    –í—Å–µ  {/* –ì–ª–æ–±–∞–ª—å–Ω—ã–µ + –°–≤–æ–∏ —Ç–µ–Ω–∞–Ω—Ç–Ω—ã–µ */}
  </ToggleButton>
  
  <ToggleButton value="global">
    <IconWorld /> –ì–ª–æ–±–∞–ª—å–Ω—ã–µ  {/* –¢–æ–ª—å–∫–æ is_global = true */}
  </ToggleButton>
  
  <ToggleButton value="tenant">
    <IconBuilding /> –ú–æ–∏  {/* –¢–æ–ª—å–∫–æ —Å–≤–æ–∏ —Ç–µ–Ω–∞–Ω—Ç–Ω—ã–µ */}
  </ToggleButton>
</ToggleButtonGroup>
```

### –õ–æ–≥–∏–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏:

```javascript
// –í –∑–∞–ø—Ä–æ—Å–µ –∫ API:
if (globalFilter === 'global') {
  params.isGlobal = 'true';  // –¢–æ–ª—å–∫–æ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ
}
if (globalFilter === 'tenant') {
  params.isGlobal = 'false'; // –¢–æ–ª—å–∫–æ —Ç–µ–Ω–∞–Ω—Ç–Ω—ã–µ
}
// –ï—Å–ª–∏ 'all' - –ø–∞—Ä–∞–º–µ—Ç—Ä –Ω–µ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è (–≥–ª–æ–±–∞–ª—å–Ω—ã–µ + —Å–≤–æ–∏)
```

---

## üîß Backend API - –õ–æ–≥–∏–∫–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

### GET /api/works

```javascript
// –ü–∞—Ä–∞–º–µ—Ç—Ä: ?isGlobal=true|false

if (isGlobal === 'true') {
  // –¢–æ–ª—å–∫–æ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ
  query += ' AND is_global = TRUE';
  
} else if (isGlobal === 'false') {
  // –¢–æ–ª—å–∫–æ —Ç–µ–Ω–∞–Ω—Ç–Ω—ã–µ (—Å–≤–æ–µ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏)
  query += ' AND is_global = FALSE';
  if (req.user && req.user.tenantId) {
    query += ` AND tenant_id = $1`;
    params.push(req.user.tenantId);
  }
  
} else {
  // –ù–µ —É–∫–∞–∑–∞–Ω–æ - –≥–ª–æ–±–∞–ª—å–Ω—ã–µ + —Å–≤–æ–∏ —Ç–µ–Ω–∞–Ω—Ç–Ω—ã–µ
  if (req.user && req.user.tenantId) {
    query += ` AND (is_global = TRUE OR tenant_id = $1)`;
    params.push(req.user.tenantId);
  } else {
    query += ' AND is_global = TRUE'; // –ì–æ—Å—Ç—å –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ
  }
}
```

### –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:
```sql
-- –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –≤—Å–µ–≥–¥–∞ —Å–Ω–∞—á–∞–ª–∞
ORDER BY is_global DESC, code ASC
```

---

## üì• –ò–º–ø–æ—Ä—Ç/–≠–∫—Å–ø–æ—Ä—Ç

### CSV —à–∞–±–ª–æ–Ω—ã:

**–ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ä–∞–±–æ—Ç—ã:**
```
–®–∞–±–ª–æ–Ω_–∏–º–ø–æ—Ä—Ç–∞_—Ä–∞–±–æ—Ç_–≥–ª–æ–±–∞–ª—å–Ω—ã–µ.csv
–≠–∫—Å–ø–æ—Ä—Ç_—Ä–∞–±–æ—Ç_–≥–ª–æ–±–∞–ª—å–Ω—ã–µ_2025-11-17.csv
```

**–¢–µ–Ω–∞–Ω—Ç–Ω—ã–µ —Ä–∞–±–æ—Ç—ã:**
```
–®–∞–±–ª–æ–Ω_–∏–º–ø–æ—Ä—Ç–∞_—Ä–∞–±–æ—Ç_–º–æ–∏.csv
–≠–∫—Å–ø–æ—Ä—Ç_—Ä–∞–±–æ—Ç_–º–æ–∏_2025-11-17.csv
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ CSV (–±–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏):
```csv
–ö–æ–¥;–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ;–ï–¥ –∏–∑–º;–ë–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞;–§–∞–∑–∞;–†–∞–∑–¥–µ–ª;–ü–æ–¥—Ä–∞–∑–¥–µ–ª
0-01;–î–µ–º–æ–Ω—Ç–∞–∂ –≤—ã—Ç—è–∂–∫–∏;—à—Ç;380.00;–≠—Ç–∞–ø ‚Ññ0;–î–µ–º–æ–Ω—Ç–∞–∂;–ë—ã—Ç–æ–≤–∞—è —Ç–µ—Ö–Ω–∏–∫–∞
```

### –†–µ–∂–∏–º—ã –∏–º–ø–æ—Ä—Ç–∞:

1. **–î–æ–±–∞–≤–∏—Ç—å** (`mode: 'add'`)
   - –î–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏ –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º
   - –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã –ø–æ `code`

2. **–ó–∞–º–µ–Ω–∏—Ç—å** (`mode: 'replace'`)
   - –£–¥–∞–ª—è–µ—Ç –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ä–∞–±–æ—Ç—ã —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞
   - –ó–∞–≥—Ä—É–∂–∞–µ—Ç –Ω–æ–≤—ã–µ –∏–∑ CSV
   - ‚ö†Ô∏è **–ì–ª–æ–±–∞–ª—å–Ω—ã–µ**: –£–¥–∞–ª—è–µ—Ç –≤—Å–µ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ ‚Üí –∑–∞–≥—Ä—É–∂–∞–µ—Ç –Ω–æ–≤—ã–µ
   - ‚ö†Ô∏è **–¢–µ–Ω–∞–Ω—Ç–Ω—ã–µ**: –£–¥–∞–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ ‚Üí –∑–∞–≥—Ä—É–∂–∞–µ—Ç –Ω–æ–≤—ã–µ

---

## üîÑ –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ù–æ–≤–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è

```javascript
// –ü—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –≥–ª–æ–±–∞–ª—å–Ω—ã–º
// –ú–æ–∂–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–≤–æ–∏ —Ç–µ–Ω–∞–Ω—Ç–Ω—ã–µ —Ä–∞–±–æ—Ç—ã

// –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –≤ —Ç–µ–Ω–∞–Ω—Ç–Ω—ã–µ
SELECT copy_global_works_to_tenant(tenant_id, user_id);
// –°–æ–∑–¥–∞—Å—Ç 3371 –∫–æ–ø–∏—é —Å is_global = false –∏ tenant_id = [–Ω–æ–≤—ã–π]
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Ö–æ—á–µ—Ç —Å–æ–∑–¥–∞—Ç—å —Å–≤–æ—é —Ä–∞–±–æ—Ç—É

```javascript
// POST /api/works
{
  "code": "MY-001",
  "name": "–ú–æ—è —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∞—è —Ä–∞–±–æ—Ç–∞",
  "unit": "—à—Ç",
  "basePrice": 1500,
  "isGlobal": false,  // –¢–µ–Ω–∞–Ω—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞
  "phase": "–≠—Ç–∞–ø ‚Ññ1",
  "section": "–ú–æ–∏ —Ä–∞–±–æ—Ç—ã",
  "subsection": "–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ"
}

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è:
// - tenant_id = req.user.tenantId
// - created_by = req.user.userId
// - is_global = false
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–æ–∑–¥–∞—ë—Ç –≥–ª–æ–±–∞–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É

```javascript
// POST /api/works
{
  "code": "GLOBAL-9999",
  "name": "–ù–æ–≤–∞—è –≥–ª–æ–±–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞",
  "unit": "–º¬≤",
  "basePrice": 800,
  "isGlobal": true,  // –ì–ª–æ–±–∞–ª—å–Ω–∞—è
  "phase": "–≠—Ç–∞–ø ‚Ññ5",
  "section": "–ù–æ–≤—ã–π —Ä–∞–∑–¥–µ–ª",
  "subsection": "–ü–æ–¥—Ä–∞–∑–¥–µ–ª"
}

// –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è:
// - tenant_id = null
// - created_by = null (–∏–ª–∏ admin_id)
// - is_global = true
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –≠–∫—Å–ø–æ—Ä—Ç —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞

**–í–∞—Ä–∏–∞–Ω—Ç A: –≠–∫—Å–ø–æ—Ä—Ç —Ç–æ–ª—å–∫–æ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö**
```javascript
// –í UI: –í—ã–±—Ä–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä "–ì–ª–æ–±–∞–ª—å–Ω—ã–µ" ‚Üí –≠–∫—Å–ø–æ—Ä—Ç
exportWorks({ isGlobal: 'true' })
// –§–∞–π–ª: –≠–∫—Å–ø–æ—Ä—Ç_—Ä–∞–±–æ—Ç_–≥–ª–æ–±–∞–ª—å–Ω—ã–µ_2025-11-17.csv
// –°–æ–¥–µ—Ä–∂–∏—Ç: 3371 –∑–∞–ø–∏—Å—å
```

**–í–∞—Ä–∏–∞–Ω—Ç B: –≠–∫—Å–ø–æ—Ä—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏—Ö**
```javascript
// –í UI: –í—ã–±—Ä–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä "–ú–æ–∏" ‚Üí –≠–∫—Å–ø–æ—Ä—Ç
exportWorks({ isGlobal: 'false' })
// –§–∞–π–ª: –≠–∫—Å–ø–æ—Ä—Ç_—Ä–∞–±–æ—Ç_–º–æ–∏_2025-11-17.csv
// –°–æ–¥–µ—Ä–∂–∏—Ç: —Ç–æ–ª—å–∫–æ —Ç–µ–Ω–∞–Ω—Ç–Ω—ã–µ —Ä–∞–±–æ—Ç—ã –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
```

**–í–∞—Ä–∏–∞–Ω—Ç C: –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö**
```javascript
// –í UI: –í—ã–±—Ä–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä "–í—Å–µ" ‚Üí –≠–∫—Å–ø–æ—Ä—Ç
exportWorks({ isGlobal: undefined })
// –§–∞–π–ª: –≠–∫—Å–ø–æ—Ä—Ç_—Ä–∞–±–æ—Ç_2025-11-17.csv
// –°–æ–¥–µ—Ä–∂–∏—Ç: –≥–ª–æ–±–∞–ª—å–Ω—ã–µ + —Å–≤–æ–∏ —Ç–µ–Ω–∞–Ω—Ç–Ω—ã–µ
```

---

## üé® –í–∏–∑—É–∞–ª—å–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã

### –í —Ç–∞–±–ª–∏—Ü–µ —Ä–∞–±–æ—Ç:

```jsx
{work.is_global ? (
  <Chip 
    icon={<IconWorld size={14} />} 
    label="–ì–ª–æ–±–∞–ª—å–Ω–∞—è" 
    size="small" 
    color="primary" 
    variant="outlined"
  />
) : (
  <Chip 
    icon={<IconBuilding size={14} />} 
    label="–ú–æ—è" 
    size="small" 
    color="secondary" 
    variant="outlined"
  />
)}
```

### –í –∫–∞—Ä—Ç–æ—á–∫–∞—Ö (–º–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è):

```jsx
<Tooltip title={work.is_global ? '–ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞' : '–†–∞–±–æ—Ç–∞ –∫–æ–º–ø–∞–Ω–∏–∏'}>
  {work.is_global ? (
    <IconWorld size={18} color="primary" />
  ) : (
    <IconBuilding size={18} color="secondary" />
  )}
</Tooltip>
```

---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –º–∏–≥—Ä–∞—Ü–∏–∏

### –ú–∏–≥—Ä–∞—Ü–∏—è 005: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ is_global

```sql
-- –î–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–ª–µ is_global –≤ —Ç–∞–±–ª–∏—Ü—ã works –∏ materials
-- –û–±–Ω–æ–≤–ª—è–µ—Ç RLS –ø–æ–ª–∏—Ç–∏–∫–∏
-- –°–æ–∑–¥–∞—ë—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–≤
-- –°–æ–∑–¥–∞—ë—Ç views –¥–ª—è –æ–±—ä–µ–¥–∏–Ω—ë–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

–§–∞–π–ª: database/migrations/005_add_global_references_support.sql
```

### –ú–∏–≥—Ä–∞—Ü–∏—è 011: –ò–µ—Ä–∞—Ä—Ö–∏—è —Ä–∞–±–æ—Ç

```sql
-- –î–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–ª—è phase, section, subsection
-- –î–ª—è –∑–∞–º–µ–Ω—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–π –Ω–∞ –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É

–§–∞–π–ª: database/migrations/011_add_work_hierarchy.sql
```

---

## üìù –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### ‚ö†Ô∏è –í–∞–∂–Ω–æ:

1. **–£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –∫–æ–¥–æ–≤:** –ö–æ–¥—ã —Ä–∞–±–æ—Ç –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã **–≥–ª–æ–±–∞–ª—å–Ω–æ** (–Ω–µ —Ç–æ–ª—å–∫–æ –≤ —Ä–∞–º–∫–∞—Ö —Ç–µ–Ω–∞–Ω—Ç–∞)
2. **–ü–æ–ª–µ category:** –û—Å—Ç–∞—ë—Ç—Å—è –≤ –ë–î –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏, –Ω–æ **–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ UI**
3. **–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:** –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ä–∞–±–æ—Ç—ã –≤—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è **–ø–µ—Ä–≤—ã–º–∏** (`ORDER BY is_global DESC`)
4. **–ò–º–ø–æ—Ä—Ç Replace:** –†–µ–∂–∏–º "–ó–∞–º–µ–Ω–∏—Ç—å" —É–¥–∞–ª—è–µ—Ç **—Ç–æ–ª—å–∫–æ** —Ä–∞–±–æ—Ç—ã –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞ (–≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ò–õ–ò —Ç–µ–Ω–∞–Ω—Ç–Ω—ã–µ)

### üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:

- RLS –≤–∫–ª—é—á–µ–Ω–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î
- –ü–æ–ª–∏—Ç–∏–∫–∏ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ
- `req.user.tenantId` –±–µ—Ä—ë—Ç—Å—è –∏–∑ JWT —Ç–æ–∫–µ–Ω–∞ (–Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–¥–¥–µ–ª–∞–Ω)
- –ê–¥–º–∏–Ω—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞—â–∏—â–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–æ–π `is_super_admin()`

### üöÄ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:

- –ò–Ω–¥–µ–∫—Å—ã —Å–æ–∑–¥–∞–Ω—ã –¥–ª—è `is_global`, `tenant_id`, `code`
- –ö–µ—à –æ—Ç–∫–ª—é—á—ë–Ω –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
- Pagination: –¥–æ 25000 –∑–∞–ø–∏—Å–µ–π –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
- Full-text search —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ –ø–æ–ª—è–º: `code`, `name`, `unit`, `phase`, `section`, `subsection`

---

## üìö –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### Frontend:
- `app/references/works/index.jsx` - –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞
- `app/references/works/ImportDialog.jsx` - –î–∏–∞–ª–æ–≥ –∏–º–ø–æ—Ä—Ç–∞
- `shared/lib/api/works.js` - API –∫–ª–∏–µ–Ω—Ç
- `shared/lib/api/worksImportExport.js` - –ò–º–ø–æ—Ä—Ç/—ç–∫—Å–ø–æ—Ä—Ç

### Backend:
- `server/controllers/worksController.js` - –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä API
- `server/routes/worksRoutes.js` - –ú–∞—Ä—à—Ä—É—Ç—ã
- `server/cache/referencesCache.js` - –ö–µ—à (–æ—Ç–∫–ª—é—á—ë–Ω)

### Database:
- `database/migrations/003_create_works_table.sql` - –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã
- `database/migrations/005_add_global_references_support.sql` - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö
- `database/migrations/011_add_work_hierarchy.sql` - –ò–µ—Ä–∞—Ä—Ö–∏—è

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
- `CHANGELOG_CSV_IMPORT.md` - –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π CSV
- `CHANGELOG_REMOVE_CATEGORY.md` - –£–¥–∞–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- `–°–ü–†–ê–í–û–ß–ù–ò–ö–ò_–°–ò–°–¢–ï–ú–ê.md` - –≠—Ç–æ—Ç —Ñ–∞–π–ª

---

## üéØ –ò—Ç–æ–≥–∏

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –¥–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã:**

‚úÖ **–ì–∏–±–∫–æ—Å—Ç—å:** –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –±–∞–∑–æ–≤—ã–π –Ω–∞–±–æ—Ä + —Å–æ–∑–¥–∞—é—Ç —Å–≤–æ–∏ —Ä–∞–±–æ—Ç—ã  
‚úÖ **–ò–∑–æ–ª—è—Ü–∏—è:** –¢–µ–Ω–∞–Ω—Ç–Ω—ã–µ —Ä–∞–±–æ—Ç—ã –≤–∏–¥–Ω—ã —Ç–æ–ª—å–∫–æ —Å–≤–æ–µ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏  
‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:** –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ä–∞–±–æ—Ç—ã –Ω–µ –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è –≤ –ë–î  
‚úÖ **–£–¥–æ–±—Å—Ç–≤–æ:** –ï–¥–∏–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ –≤—Å–µ–º–∏ —Ç–∏–ø–∞–º–∏ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–≤  
‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** RLS –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∏–∑–æ–ª—è—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö  

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- üåç 3371 –≥–ª–æ–±–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ (–±–∞–∑–æ–≤—ã–π —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫)
- üè¢ 0 —Ç–µ–Ω–∞–Ω—Ç–Ω—ã—Ö —Ä–∞–±–æ—Ç (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–≤–æ–∏)
- üìã 7 –ø–æ–ª–µ–π –≤ CSV (–±–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏)
- üîç –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ –ø–æ –∏–µ—Ä–∞—Ä—Ö–∏–∏
- üìä –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è: –í—Å–µ / –ì–ª–æ–±–∞–ª—å–Ω—ã–µ / –ú–æ–∏

---

*–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω: 17 –Ω–æ—è–±—Ä—è 2025*  
*–í–µ—Ä—Å–∏—è —Å–∏—Å—Ç–µ–º—ã: v1.17*
