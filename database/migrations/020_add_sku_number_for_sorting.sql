-- ============================================
-- –ú–ò–ì–†–ê–¶–ò–Ø: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —á–∏—Å–ª–æ–≤–æ–π —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –¥–ª—è SKU
-- –î–∞—Ç–∞: 19.10.2025
-- –û–ø–∏—Å–∞–Ω–∏–µ: –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ú-1, –ú-10, –ú-100
-- ============================================

-- –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–ª–æ–Ω–∫—É sku_number –¥–ª—è —á–∏—Å–ª–æ–≤–æ–π —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
ALTER TABLE materials 
ADD COLUMN IF NOT EXISTS sku_number INTEGER;

-- –ó–∞–ø–æ–ª–Ω—è–µ–º sku_number –∏–∑ sku (–ú-123 ‚Üí 123)
UPDATE materials 
SET sku_number = CAST(SUBSTRING(sku FROM '–ú-([0-9]+)') AS INTEGER)
WHERE sku ~ '^–ú-[0-9]+$';

-- –°–æ–∑–¥–∞—ë–º –∏–Ω–¥–µ–∫—Å –¥–ª—è –±—ã—Å—Ç—Ä–æ–π —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
CREATE INDEX IF NOT EXISTS idx_materials_sku_number ON materials(sku_number);

-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∫–æ–ª–æ–Ω–∫–µ
COMMENT ON COLUMN materials.sku_number IS '–ß–∏—Å–ª–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ SKU –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ (–ú-123 ‚Üí 123)';

-- –£—Å–ø–µ—à–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏
DO $$
BEGIN
  RAISE NOTICE '‚úÖ –ö–æ–ª–æ–Ω–∫–∞ sku_number –¥–æ–±–∞–≤–ª–µ–Ω–∞';
  RAISE NOTICE '‚úÖ –ó–Ω–∞—á–µ–Ω–∏—è –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –∏–∑ sku';
  RAISE NOTICE '‚úÖ –ò–Ω–¥–µ–∫—Å idx_materials_sku_number —Å–æ–∑–¥–∞–Ω';
  RAISE NOTICE '';
  RAISE NOTICE 'üìù –¢–µ–ø–µ—Ä—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ:';
  RAISE NOTICE '   ORDER BY sku_number ASC ‚Üí –ú-1, –ú-2, ..., –ú-10, –ú-11, ...';
END $$;
