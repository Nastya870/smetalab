# ‚úÖ –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ü–†–û–í–ï–†–û–ö (12 —è–Ω–≤–∞—Ä—è 2026)

–≠—Ç–æ—Ç —Ñ–∞–π–ª –¥–æ–ø–æ–ª–Ω—è–µ—Ç `Refactoringbd.md` —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫.

---

## –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –º–∏–≥—Ä–∞—Ü–∏–π

- **Runner**: `scripts/runMigrations.js` (—Å–≤–æ–π SQL-runner)
- **–¢–∞–±–ª–∏—Ü–∞ —É—á—ë—Ç–∞**: ‚ùå –ù–ï–¢ (–º–∏–≥—Ä–∞—Ü–∏–∏ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–µ —Å `IF NOT EXISTS`)
- **–†–µ—à–µ–Ω–∏–µ**: –°–æ–∑–¥–∞–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ `schema_version` (–º–∏–≥—Ä–∞—Ü–∏—è 062)

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π suppliers

| –ü—Ä–æ–≤–µ—Ä–∫–∞ | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|----------|-----------|
| Foreign Keys | ‚úÖ –ù–ï–¢ |
| Views | ‚úÖ –ù–ï–¢ |
| –§—É–Ω–∫—Ü–∏–∏ | ‚úÖ –ù–ï–¢ |
| –¢—Ä–∏–≥–≥–µ—Ä—ã | ‚úÖ –ù–ï–¢ |
| RLS –ø–æ–ª–∏—Ç–∏–∫–∏ | ‚úÖ –ù–ï–¢ |

**–í—ã–≤–æ–¥**: –¢–∞–±–ª–∏—Ü—É `suppliers` –º–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ —É–¥–∞–ª–∏—Ç—å ‚úÖ

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ RLS –¥–ª—è CRON –æ—á–∏—Å—Ç–∫–∏

| –¢–∞–±–ª–∏—Ü–∞ | RLS | –ò–Ω–¥–µ–∫—Å expires_at |
|---------|-----|-------------------|
| sessions | ‚ö†Ô∏è –î–ê ‚Äî –Ω—É–∂–Ω–æ –æ—Ç–∫–ª—é—á–∞—Ç—å –ø—Ä–∏ –æ—á–∏—Å—Ç–∫–µ | ‚úÖ –ï–°–¢–¨ |
| email_verification_tokens | ‚úÖ –ù–ï–¢ | ‚úÖ –ï–°–¢–¨ |
| password_resets | - | - |

---

## üìÅ –°–û–ó–î–ê–ù–ù–´–ï –ú–ò–ì–†–ê–¶–ò–ò

| –§–∞–π–ª | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|------------|
| `062_create_schema_version.sql` | –¢–∞–±–ª–∏—Ü–∞ —É—á—ë—Ç–∞ –º–∏–≥—Ä–∞—Ü–∏–π |
| `063_drop_suppliers.sql` | –£–¥–∞–ª–µ–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–µ–π —Ç–∞–±–ª–∏—Ü—ã |
| `064_cleanup_expired_tokens.sql` | –û—á–∏—Å—Ç–∫–∞ —Å —É—á—ë—Ç–æ–º RLS |

---

## üìÅ –°–û–ó–î–ê–ù–ù–´–ï –°–ö–†–ò–ü–¢–´ –ê–ù–ê–õ–ò–ó–ê

| –§–∞–π–ª | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|------------|
| `scripts/analyzeDatabaseSchema.js` | –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å—Ö–µ–º—ã –ë–î |
| `scripts/analyzeRolesDuplicates.js` | –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–µ–π —Ä–æ–ª–µ–π |
| `scripts/fullDependencyCheck.js` | –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π —Ç–∞–±–ª–∏—Ü |
| `scripts/checkRefactoringReadiness.js` | –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É |
| `scripts/checkSuppliersTable.js` | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–±–ª–∏—Ü—ã suppliers |

---

## üöÄ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

1. [ ] –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ 062-064 –Ω–∞ –ø—Ä–æ–¥
2. [ ] –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å baseline —á–µ—Ä–µ–∑ `pg_dump --schema-only`
3. [ ] –†–∞–∑—Ä–µ–∑–∞—Ç—å –Ω–∞ 001..004 (—Ç–∞–±–ª–∏—Ü—ã, —Ñ—É–Ω–∫—Ü–∏–∏, RLS, –∏–Ω–¥–µ–∫—Å—ã)
4. [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å baseline –Ω–∞ –ø—É—Å—Ç–æ–π –ë–î
5. [ ] –ê—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ `migrations_archive/original/`
6. [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å CRON –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ —Å–µ—Å—Å–∏–π (—Å —É—á—ë—Ç–æ–º RLS)

---

## –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ baseline

```powershell
$env:PGPASSWORD="<PASSWORD>"
pg_dump -h dpg-xxx.frankfurt-postgres.render.com -U smetalab_user -d smetalab_yay5 `
  --schema-only `
  --no-owner `
  --no-privileges `
  --quote-all-identifiers `
  > database/baseline/001_full_schema.sql
```

---

*–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ: 12 —è–Ω–≤–∞—Ä—è 2026*
